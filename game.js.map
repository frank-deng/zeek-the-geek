{"version":3,"file":"game.js","sources":["js/maze.js","js/image.js","js/misc.js","js/level.js","js/object.js","js/demon.js","js/game.js","js/stage.js","js/player.js"],"sourcesContent":["class Maze{\n\tSPACE = undefined;\n\tWALL = 1;\n\tFOOTPRINT = 2;\n\tgoal = undefined;\n\tfootPrint = new Array();\n\tconstructor(w, h, initfunc){\n\t\tthis.w = w;\n\t\tthis.h = h;\n\t\tthis.data = new Array(this.w * this.h);\n\n\t\t//Init\n\t\tif (undefined != initfunc) {\n\t\t\tinitfunc(this);\n\t\t}\n\t}\n\tget(x, y) {\n\t\treturn this.data[x + y * this.w];\n\t}\n\tset(x, y, element){\n\t\tdelete this.data[x + y * this.w];\n\t\tthis.data[x + y * this.w] = element;\n\t}\n\tgetDir(x0, y0, x1, y1) {\n\t\tvar goal = this.goal;\n\t\tvar dx = x1 - x0;\n\t\tvar dy = y1 - y0;\n\n\t\tif (dx == 0 && dy == 0) {\n\t\t\treturn [];\n\t\t} else if (dx >= 0 && dy < 0) {\n\t\t\tif (dx >= -dy) {\n\t\t\t\treturn ['E', 'N', 'S', 'W'];\n\t\t\t} else {\n\t\t\t\treturn ['N', 'E', 'W', 'S'];\n\t\t\t}\n\t\t} else if (dx < 0 && dy < 0) {\n\t\t\tif (-dx >= -dy) {\n\t\t\t\treturn ['W', 'N', 'S', 'E'];\n\t\t\t} else {\n\t\t\t\treturn ['N', 'W', 'E', 'S'];\n\t\t\t}\n\t\t} else if (dx < 0 && dy >= 0) {\n\t\t\tif (-dx >= dy) {\n\t\t\t\treturn ['W', 'S', 'N', 'E'];\n\t\t\t} else {\n\t\t\t\treturn ['S', 'W', 'E', 'N'];\n\t\t\t}\n\t\t} else if (dx >= 0 && dy >= 0) {\n\t\t\tif (dx >= dy) {\n\t\t\t\treturn ['E', 'S', 'N', 'W'];\n\t\t\t} else {\n\t\t\t\treturn ['S', 'E', 'W', 'N'];\n\t\t\t}\n\t\t}\n\t}\n\treachable(x, y){\n\t\tif (x < 0 || x >= this.w || y < 0 || y >= this.h) {\n\t\t\treturn false;\n\t\t} else if (this.SPACE != this.get(x, y)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\tgetPosByDir(x, y, dir){\n\t\tvar result;\n\t\tswitch (dir) {\n\t\t\tcase 'N':\n\t\t\t\tresult = {x:x, y:y-1};\n\t\t\tbreak;\n\t\t\tcase 'E':\n\t\t\t\tresult = {x:x+1, y:y};\n\t\t\tbreak;\n\t\t\tcase 'W':\n\t\t\t\tresult = {x:x-1, y:y};\n\t\t\tbreak;\n\t\t\tcase 'S':\n\t\t\t\tresult = {x:x, y:y+1};\n\t\t\tbreak;\n\t\t}\n\t\treturn result;\n\t}\n\tnext(){\n\t\tif (0 == this.footPrint.length) {\n\t\t\treturn false;\n\t\t}\n\t\tvar currentPos = this.footPrint[this.footPrint.length - 1];\n\t\tif (currentPos.x == this.goal.x && currentPos.y == this.goal.y) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar dirCandidate = this.getDir(currentPos.x, currentPos.y, this.goal.x, this.goal.y);\n\t\tfor (var i in dirCandidate) {\n\t\t\tvar nextPos = this.getPosByDir(currentPos.x, currentPos.y, dirCandidate[i]);\n\t\t\tif (this.reachable(nextPos.x, nextPos.y)) {\n\t\t\t\tthis.footPrint.push(nextPos);\n\t\t\t\tthis.set(nextPos.x, nextPos.y, this.FOOTPRINT);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\t//None of the directions reachable\n\t\tvar posBlock = this.footPrint.pop();\n\t\treturn true;\n\t}\n}\nexport default function(stage, player, destCol, destRow) {\n\tvar result = new Array();\n\tvar maze = new Maze(stage.cols, stage.rows, function(maze){\n\t\tvar col, row;\n\t\tfor (row = 0; row < stage.rows; row++) {\n\t\t\tfor (col = 0; col < stage.cols; col++) {\n\t\t\t\tlet object = stage.getObject(col, row);\n\t\t\t\tif (undefined == object) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t//Trigger blackArea()\n\t\t\t\tif (undefined != object.blackArea) {\n\t\t\t\t\tvar posList = object.blackArea(stage, col, row);\n\t\t\t\t\tfor (var i = 0; i < posList.length; i++) {\n\t\t\t\t\t\tmaze.set(posList[i].col, posList[i].row, maze.WALL);\n\t\t\t\t\t}\n\t\t\t\t} else if (true != object.pick) { //Non-pickable objects\n\t\t\t\t\tmaze.set(col, row, maze.WALL);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tmaze.goal = {x:destCol, y:destRow};\n\t\tmaze.footPrint = [{x:player.Moveable.col, y:player.Moveable.row}];\n\t});\n\n\t//Solve \n\twhile(maze.next());\n\n\t//Process the result\n\tvar resultRaw = maze.footPrint;\n\tif (0 == maze.footPrint.length) {\n\t\tresult = undefined;\n\t} else {\n\t\tfor (var i in maze.footPrint) {\n\t\t\tresult.push({col:resultRaw[i].x, row:resultRaw[i].y});\n\t\t}\n\t}\n\treturn result;\n}\n\n","export const IMAGE_W = 36;\nexport const IMAGE_H = 36;\nexport function drawImage(__image, ctx, col, row) {\n\tctx.drawImage(__image.img,\n\t\t(__image.x * IMAGE_W), (__image.y * IMAGE_H), IMAGE_W, IMAGE_H,\n\t\tMath.floor(col * IMAGE_W), Math.floor(row * IMAGE_H), IMAGE_W, IMAGE_H);\n}\n\nvar imageObj = new Array();\nimageObj[0] = new Image();\nimageObj[0].src = 'image/1.gif';\nimageObj[1] = new Image();\nimageObj[1].src = 'image/2.gif';\nimageObj[2] = new Image();\nimageObj[2].src = 'image/3.gif';\nimageObj[3] = new Image();\nimageObj[3].src = 'image/4.gif';\n\nimage = new Array();\nexport var image;\nimage[undefined] = {img:imageObj[0], x:1, y:11};\nimage['Apple'] = {img:imageObj[1], x:1, y:0};\nimage['AppleRotten'] = [\n\t{img:imageObj[0], x:1, y:0},\n\t{img:imageObj[0], x:1, y:1},\n];\nimage['Ball'] = {img:imageObj[1], x:1, y:1};\nimage['Bomb'] = {\n\tnormal: {img:imageObj[0], x:1, y:2},\n\tticking: [\n\t\t{img:imageObj[0], x:1, y:3},\n\t\t{img:imageObj[0], x:1, y:4},\n\t],\n\tdetonate: {img:imageObj[1], x:0, y:12},\n};\nimage['Crystal'] = [\n\t{img:imageObj[0], x:1, y:5},\n\t{img:imageObj[0], x:1, y:6},\n\t{img:imageObj[0], x:1, y:7},\n];\nimage['Demon'] = {\n\t'N':[\n\t\t{img:imageObj[0], x:0, y:7},\n\t\t{img:imageObj[0], x:0, y:6},\n\t\t{img:imageObj[0], x:0, y:8},\n\t],\n\t'E':[\n\t\t{img:imageObj[0], x:0, y:0},\n\t\t{img:imageObj[0], x:0, y:1},\n\t\t{img:imageObj[0], x:0, y:2},\n\t],\n\t'W':[\n\t\t{img:imageObj[0], x:0, y:9},\n\t\t{img:imageObj[0], x:0, y:10},\n\t\t{img:imageObj[0], x:0, y:11},\n\t],\n\t'S':[\n\t\t{img:imageObj[0], x:0, y:4},\n\t\t{img:imageObj[0], x:0, y:3},\n\t\t{img:imageObj[0], x:0, y:5},\n\t],\n};\nimage['Destroyed'] = {img:imageObj[1], x:0, y:11};\nimage['Door'] = {img:imageObj[1], x:1, y:3};\nimage['Egg'] = {img:imageObj[1], x:1, y:4};\nimage['Flower'] = [\n\t{img:imageObj[1], x:1, y:6},\n\t{img:imageObj[1], x:1, y:5},\n];\nimage['Key'] = {img:imageObj[1], x:1, y:7};\nimage['LaserGun'] = {img:imageObj[1], x:1, y:8};\nimage['Mushroom'] = [\n\t{img:imageObj[1], x:1, y:9},\n\t{img:imageObj[1], x:1, y:10},\n];\nimage['Player'] = {\n\t'N':[\n\t\t{img:imageObj[1], x:2, y:11},\n\t\t{img:imageObj[1], x:2, y:10},\n\t\t{img:imageObj[1], x:2, y:12},\n\t],\n\t'E':[\n\t\t{img:imageObj[1], x:2, y:5},\n\t\t{img:imageObj[1], x:2, y:6},\n\t\t{img:imageObj[1], x:2, y:7},\n\t],\n\t'W':[\n\t\t{img:imageObj[1], x:3, y:12},\n\t\t{img:imageObj[1], x:3, y:13},\n\t\t{img:imageObj[1], x:3, y:14},\n\t],\n\t'S':[\n\t\t{img:imageObj[1], x:2, y:0},\n\t\t{img:imageObj[1], x:2, y:8},\n\t\t{img:imageObj[1], x:2, y:9},\n\t],\n\t'sleepy':[\n\t\t{img:imageObj[1], x:2, y:0},\n\t\t{img:imageObj[1], x:2, y:1},\n\t\t{img:imageObj[1], x:2, y:2},\n\t\t{img:imageObj[1], x:2, y:3},\n\t\t{img:imageObj[1], x:2, y:4},\n\t],\n\t'poisoned': [\n\t\t{img:imageObj[1], x:3, y:0},\n\t\t{img:imageObj[1], x:3, y:1},\n\t\t{img:imageObj[1], x:3, y:2},\n\t\t{img:imageObj[1], x:3, y:3},\n\t\t{img:imageObj[1], x:3, y:4},\n\t\t{img:imageObj[1], x:3, y:5},\n\t\t{img:imageObj[1], x:3, y:6},\n\t\t{img:imageObj[1], x:3, y:7},\n\t\t{img:imageObj[1], x:3, y:8},\n\t\t{img:imageObj[1], x:3, y:9},\n\t\t{img:imageObj[1], x:3, y:10},\n\t\t{img:imageObj[1], x:3, y:11},\n\t\t{img:imageObj[1], x:2, y:0},\n\t],\n};\nimage['PlayerGirl'] = {\n\t'N':[\n\t\t{img:imageObj[3], x:0, y:11},\n\t\t{img:imageObj[3], x:0, y:10},\n\t\t{img:imageObj[3], x:0, y:12},\n\t],\n\t'E':[\n\t\t{img:imageObj[3], x:0, y:5},\n\t\t{img:imageObj[3], x:0, y:6},\n\t\t{img:imageObj[3], x:0, y:7},\n\t],\n\t'W':[\n\t\t{img:imageObj[3], x:1, y:12},\n\t\t{img:imageObj[3], x:1, y:13},\n\t\t{img:imageObj[3], x:1, y:14},\n\t],\n\t'S':[\n\t\t{img:imageObj[3], x:0, y:0},\n\t\t{img:imageObj[3], x:0, y:8},\n\t\t{img:imageObj[3], x:0, y:9},\n\t],\n\t'sleepy':[\n\t\t{img:imageObj[3], x:0, y:0},\n\t\t{img:imageObj[3], x:0, y:1},\n\t\t{img:imageObj[3], x:0, y:2},\n\t\t{img:imageObj[3], x:0, y:3},\n\t\t{img:imageObj[3], x:0, y:4},\n\t],\n\t'poisoned': [\n\t\t{img:imageObj[3], x:1, y:0},\n\t\t{img:imageObj[3], x:1, y:1},\n\t\t{img:imageObj[3], x:1, y:2},\n\t\t{img:imageObj[3], x:1, y:3},\n\t\t{img:imageObj[3], x:1, y:4},\n\t\t{img:imageObj[3], x:1, y:5},\n\t\t{img:imageObj[3], x:1, y:6},\n\t\t{img:imageObj[3], x:1, y:7},\n\t\t{img:imageObj[3], x:1, y:8},\n\t\t{img:imageObj[3], x:1, y:9},\n\t\t{img:imageObj[3], x:1, y:10},\n\t\t{img:imageObj[3], x:1, y:11},\n\t\t{img:imageObj[3], x:0, y:0},\n\t],\n};\nimage['PFlower'] = {\n\tdigest: [\n\t\t{img:imageObj[0], x:2, y:0},\n\t\t{img:imageObj[0], x:2, y:7},\n\t\t{img:imageObj[0], x:2, y:6},\n\t\t{img:imageObj[0], x:2, y:5},\n\t\t{img:imageObj[0], x:2, y:4},\n\t],\n\topen: [\n\t\t{img:imageObj[0], x:2, y:3},\n\t\t{img:imageObj[0], x:2, y:2},\n\t\t{img:imageObj[0], x:2, y:1},\n\t\t{img:imageObj[0], x:2, y:0},\n\t],\n\tplayer: [\n\t\t{img:imageObj[0], x:1, y:8},\n\t\t{img:imageObj[0], x:1, y:9},\n\t\t{img:imageObj[0], x:1, y:10},\n\t],\n\tgrab: {\n\t\t'N': {img:imageObj[2], x:0, y:1},\n\t\t'E': {img:imageObj[2], x:0, y:3},\n\t\t'W': {img:imageObj[2], x:1, y:2},\n\t\t'S': {img:imageObj[2], x:1, y:0},\n\t},\n};\nimage['Pill'] = {img:imageObj[1], x:1, y:11};\nimage['SpacerLaser'] = [\n\t{img:imageObj[0], x:2, y:8},\n\t{img:imageObj[0], x:2, y:9},\n];\nimage['SpacerPFlower'] = {\n\tgrabApple: {\n\t\t'N': {img:imageObj[2], x:0, y:0},\n\t\t'E': {img:imageObj[2], x:1, y:3},\n\t\t'W': {img:imageObj[2], x:0, y:2},\n\t\t'S': {img:imageObj[2], x:1, y:1},\n\t},\n\tgrabPlayer: {\n\t\t'N': {img:imageObj[2], x:2, y:0},\n\t\t'E': {img:imageObj[2], x:3, y:3},\n\t\t'W': {img:imageObj[2], x:2, y:2},\n\t\t'S': {img:imageObj[2], x:3, y:1},\n\t},\n};\nimage['Treasure'] = {img:imageObj[1], x:0, y:10},\nimage['Wall'] = [\n\t{img:imageObj[1], x:0, y:0},\n\t{img:imageObj[1], x:0, y:1},\n\t{img:imageObj[1], x:0, y:2},\n\t{img:imageObj[1], x:0, y:3},\n\t{img:imageObj[1], x:0, y:4},\n\t{img:imageObj[1], x:0, y:5},\n\t{img:imageObj[1], x:0, y:6},\n\t{img:imageObj[1], x:0, y:7},\n\t{img:imageObj[1], x:0, y:8},\n\t{img:imageObj[1], x:0, y:9},\n\t{img:imageObj[1], x:1, y:2},\n]\n","import {image,drawImage} from './image';\n\nexport const DIR_NORTH='N';\nexport const DIR_EAST='E';\nexport const DIR_WEST='W';\nexport const DIR_SOUTH='S';\n\nexport const DIR_LEFT='L';\nexport const DIR_RIGHT='R';\nexport const DIR_BACK='B';\n\nexport function switchDir(dir, sw) {\n\tvar expr;\n\tswitch (dir) {\n\t\tcase DIR_NORTH:\n\t\t\texpr = {'L':DIR_WEST, 'R':DIR_EAST, 'B':DIR_SOUTH};\n\t\tbreak;\n\t\tcase DIR_EAST:\n\t\t\texpr = {'L':DIR_NORTH, 'R':DIR_SOUTH, 'B':DIR_WEST};\n\t\tbreak;\n\t\tcase DIR_WEST:\n\t\t\texpr = {'L':DIR_SOUTH, 'R':DIR_NORTH, 'B':DIR_EAST};\n\t\tbreak;\n\t\tcase DIR_SOUTH:\n\t\t\texpr = {'L':DIR_EAST, 'R':DIR_WEST, 'B':DIR_NORTH};\n\t\tbreak;\n\t\tdefault:\n\t\t\tthrow TypeError;\n\t\tbreak;\n\t}\n\tif (undefined == expr[sw]) {\n\t\tthrow TypeError;\n\t}\n\treturn expr[sw];\n}\nexport function getDir(col0, row0, col1, row1){\n\tif (row0 == row1 && col0 == col1) {\n\t\treturn undefined;\n\t}\n\tif (row0 == row1) {\n\t\treturn (col0 < col1 ? DIR_EAST : DIR_WEST);\n\t} else if (col0 == col1) {\n\t\treturn (row0 < row1 ? DIR_SOUTH : DIR_NORTH);\n\t} else {\n\t\treturn undefined;\n\t}\n}\nexport class Moveable{\n\tstepMax = 8;\n\tcolPrev = undefined;\n\trowPrev = undefined;\n\tstep = 0;\n\n\tconstructor(col, row, dir){\n\t\tthis.col = col;\n\t\tthis.row = row;\n\t\tthis.dir = dir;\n\t}\n\n\tisMoving(){\n\t\tif (this.step > 0) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tmove(dir){\n\t\tif (this.isMoving()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.dir = dir;\n\t\tthis.step = this.stepMax;\n\t\tthis.colPrev = this.col;\n\t\tthis.rowPrev = this.row;\n\t\tswitch(dir) {\n\t\t\tcase DIR_NORTH:\n\t\t\t\tthis.row--;\n\t\t\tbreak;\n\t\t\tcase DIR_EAST:\n\t\t\t\tthis.col++;\n\t\t\tbreak;\n\t\t\tcase DIR_WEST:\n\t\t\t\tthis.col--;\n\t\t\tbreak;\n\t\t\tcase DIR_SOUTH:\n\t\t\t\tthis.row++;\n\t\t\tbreak;\n\t\t}\n\t\treturn true;\n\t}\n\tonTick(){\n\t\tvar result = undefined;\n\t\tif (this.isMoving()) {\n\t\t\tthis.step--;\n\t\t\tif (!this.isMoving()) {\n\t\t\t\tresult = {colPrev: this.colPrev, rowPrev: this.rowPrev};\n\t\t\t\tthis.colPrev = this.rowPrev = undefined;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\tonDraw(img, ctx){\n\t\tswitch (this.dir){\n\t\t\tcase DIR_NORTH:\n\t\t\t\tdrawImage(img, ctx, this.col, this.row + this.step / this.stepMax);\n\t\t\tbreak;\n\t\t\tcase DIR_EAST:\n\t\t\t\tdrawImage(img, ctx, this.col - this.step / this.stepMax, this.row);\n\t\t\tbreak;\n\t\t\tcase DIR_WEST:\n\t\t\t\tdrawImage(img, ctx, this.col + this.step / this.stepMax, this.row);\n\t\t\tbreak;\n\t\t\tcase DIR_SOUTH:\n\t\t\t\tdrawImage(img, ctx, this.col, this.row - this.step / this.stepMax);\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\n//Handle sound via WebAudioAPI\nconst audioContext=new AudioContext();\nasync function loadSound(fileList){\n\tlet taskList=[], result={};\n\tfor(let fileName of fileList){\n\t\t(function(fileName){\n\t\t\ttaskList.push({\n\t\t\t\tfileName,\n\t\t\t\ttask:new Promise(async(resolve)=>{\n\t\t\t\t\tlet resp=await fetch(`./audio/${fileName}.wav`);\n\t\t\t\t\tif(!resp.ok){\n\t\t\t\t\t\tconsole.error(`Failed to load ${fileName}.wav: ${resp.statusText}`);\n\t\t\t\t\t\tresolve(null);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\taudioContext.decodeAudioData(await resp.arrayBuffer(),resolve);\n\t\t\t\t})\n\t\t\t});\n\t\t})(fileName);\n\t}\n\tlet respAll=await Promise.all(taskList.map(item=>item.task));\n\ttaskList.forEach((task,idx)=>{\n\t\tresult[task.fileName]=respAll[idx] || null;\n\t});\n\treturn result;\n}\nlet audioTable={\n\tbitten:null,\n\tcrystal:null,\n\tdetonate:null,\n\tgrab:null,\n\tlasershot:null,\n\tpick:null,\n\tpoisoned:null,\n\tstep:null\n};\nloadSound(Object.keys(audioTable)).then((data)=>{\n\taudioTable=data;\n});\nexport function playAudio(audioFile) {\n\tif(!document.querySelector('input#enableSound').checked || !audioTable[audioFile]){\n\t\treturn;\n\t}\n\tlet source = audioContext.createBufferSource();\n    source.buffer = audioTable[audioFile];\n    source.loop = false;\n    source.connect(audioContext.destination);\n\tsource.start();\n}\n\n","import mazeSolver from './maze';\nimport { getDir } from './misc';\nimport {IMAGE_W, IMAGE_H} from './image';\n\nfunction getDirFromRoute(player, playerRoute) {\n\tvar nextDir = undefined;\n\n\t//Process playerRoute\n\twhile (playerRoute.length > 0\n\t\t&& player.Moveable.col == playerRoute[0].col\n\t\t&& player.Moveable.row == playerRoute[0].row) {\n\t\tplayerRoute.splice(0, 1);\n\t}\n\n\t//Get direction from playerRoute\n\tif (playerRoute.length > 0) {\n\t\tvar dir = getDir(player.Moveable.col, player.Moveable.row,\n\t\t\tplayerRoute[0].col, playerRoute[0].row);\n\t\tif (undefined != dir) {\n\t\t\tnextDir = dir;\n\t\t} else {\n\t\t\tvar solved = mazeSolver(player.stage, player,\n\t\t\t\tplayerRoute[0].col, playerRoute[0].row);\n\t\t\tif (undefined != solved) {\n\t\t\t\tlet len = solved.length\n\t\t\t\tfor (var i = len - 1; i >= 0; i--) {\n\t\t\t\t\tplayerRoute.splice(0, 0, solved[i]);\n\t\t\t\t}\n\t\t\t\tsolved=[];\n\t\t\t\tnextDir = getDir(player.Moveable.col, player.Moveable.row, playerRoute[0].col, playerRoute[0].row);\n\t\t\t}\n\t\t}\n\t}\n\treturn nextDir;\n}\nexport default class Level{\n\tscore = 0;\n\tspeed = 100;\n\tpaused = false;\n\tdirKeyPressed = [undefined, undefined];\n\tnextDir = [undefined, undefined];\n\tplayerRoute = [new Array(), new Array()];\n\tplayerRouteInUse = 0;\n\tconstructor(stage, ctx){\n\t\tthis.stage=stage;\n\t\tthis.ctx=ctx;\n\t\tdocument.addEventListener('keydown',this.keydownHandler);\n\t\tdocument.addEventListener('keyup',this.keyupHandler);\n\t\tdocument.querySelector('canvas#stage').addEventListener('mousedown',this.mousedownHandler);\n\t\t//Play this level\n\t\tsetTimeout(this.timeoutFunc, this.speed);\n\t}\n\tonFinish(func){\n\t\tthis._onFinish=func;\n\t}\n\tcallOnFinish(score){\n\t\tdocument.removeEventListener('keydown',this.keydownHandler);\n\t\tdocument.removeEventListener('keyup',this.keyupHandler);\n\t\tdocument.querySelector('canvas#stage').removeEventListener('mousedown',this.mousedownHandler);\n\t\tif(this._onFinish){\n\t\t\tthis._onFinish(score);\n\t\t}\n\t}\n\ttimeoutFunc=()=>{\n\t\ttry{\n\t\t\tif (!this.paused) {\n\t\t\t\tvar player = this.stage.player;\n\n\t\t\t\t//Decide which direction to go next\n\t\t\t\tfor (var i in player) {\n\t\t\t\t\tif (!player[i] || player[i].Moveable.isMoving()) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (undefined != this.dirKeyPressed[i]) {\n\t\t\t\t\t\tplayer[i].move(this.dirKeyPressed[i]);\n\t\t\t\t\t\tthis.playerRoute[i]=[];\n\t\t\t\t\t} else if (undefined != this.nextDir[i]) {\n\t\t\t\t\t\tif (player[i].Moveable.dir != this.nextDir[i]) {\n\t\t\t\t\t\t\tplayer[i].move(this.nextDir[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.playerRoute[i]=[];\n\t\t\t\t\t\tthis.nextDir[i] = undefined;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar dir = getDirFromRoute(player[i], this.playerRoute[i]);\n\t\t\t\t\t\tif (undefined != dir) {\n\t\t\t\t\t\t\tplayer[i].move(dir);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//Power the whole game\n\t\t\t\tthis.stage.tick(this.ctx);\n\t\t\t\tthis.stage.draw(this.ctx);\n\n\t\t\t\t//Display and misceallanous things\n\t\t\t\tdocument.querySelector('div#paused').style.display='none';\n\t\t\t\tdocument.querySelector('span#score').innerHTML=this.stage.score;\n\t\t\t} else {\n\t\t\t\tdocument.querySelector('div#paused').style.display=null;\n\t\t\t}\n\n\t\t\t//Level finished or continue\n\t\t\tif (this.stage.finished) {\n\t\t\t\tthis.score = this.stage.score;\n\t\t\t\tthis.stage.reset();\n\t\t\t\tthis.callOnFinish(this.score);\n\t\t\t} else {\n\t\t\t\tsetTimeout(this.timeoutFunc, this.speed);\n\t\t\t}\n\t\t}catch(e){\n\t\t\tconsole.error(e);\n\t\t\tsetTimeout(this.timeoutFunc, this.speed);\n\t\t}\n\t}\n\tkeydownHandler=(event)=>{\n\t\tif (!this.paused) {\n\t\t\tlet nextDir=this.nextDir, dirKeyPressed=this.dirKeyPressed;\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase 37:\t//Left\n\t\t\t\t\tnextDir[0] = dirKeyPressed[0] = DIR_WEST;\n\t\t\t\tbreak;\n\t\t\t\tcase 38:\t//Up\n\t\t\t\t\tnextDir[0] = dirKeyPressed[0] = DIR_NORTH;\n\t\t\t\tbreak;\n\t\t\t\tcase 39:\t//Right\n\t\t\t\t\tnextDir[0] = dirKeyPressed[0] = DIR_EAST;\n\t\t\t\tbreak;\n\t\t\t\tcase 40:\t//Down\n\t\t\t\t\tnextDir[0] = dirKeyPressed[0] = DIR_SOUTH;\n\t\t\t\tbreak;\n\t\t\t\tcase 65:\t//A\n\t\t\t\t\tnextDir[1] = dirKeyPressed[1] = DIR_WEST;\n\t\t\t\tbreak;\n\t\t\t\tcase 87:   //W\n\t\t\t\t\tnextDir[1] = dirKeyPressed[1] = DIR_NORTH;\n\t\t\t\tbreak;\n\t\t\t\tcase 68:   //D\n\t\t\t\t\tnextDir[1] = dirKeyPressed[1] = DIR_EAST;\n\t\t\t\tbreak;\n\t\t\t\tcase 83:   //S\n\t\t\t\t\tnextDir[1] = dirKeyPressed[1] = DIR_SOUTH;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tswitch (event.keyCode) {\n\t\t\tcase 48:\t//9\n\t\t\t\tthis.playerRouteInUse = 0;\n\t\t\tbreak;\n\t\t\tcase 57:\t//0\n\t\t\t\tthis.playerRouteInUse = 1;\n\t\t\tbreak;\n\t\t\tcase 80:\t//P: Pause\n\t\t\t\tthis.paused = !this.paused;\n\t\t\tbreak;\n\t\t\tcase 82:\t//R: Restart\n\t\t\t\tfor (var i in this.nextDir) {\n\t\t\t\t\tthis.nextDir[i] = undefined;\n\t\t\t\t}\n\t\t\t\tfor (var i in this.dirKeyPressed) {\n\t\t\t\t\tthis.dirKeyPressed[i] = undefined;\n\t\t\t\t}\n\t\t\t\tfor (var i in this.playerRoute) {\n\t\t\t\t\tthis.playerRoute[i]=[];\n\t\t\t\t}\n\t\t\t\tthis.stage.reset();\n\t\t\t\tthis.paused = false;\n\t\t\tbreak;\n\t\t\tcase 32:\t//Space: speed up the game\n\t\t\t\tthis.speed = 20;\n\t\t\tbreak;\n\t\t}\n\t}\n\tkeyupHandler=(event)=>{\n\t\tif (!this.paused) {\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase 37:\t//Left\n\t\t\t\tcase 38:\t//Up\n\t\t\t\tcase 39:\t//Right\n\t\t\t\tcase 40:\t//Down\n\t\t\t\t\tthis.dirKeyPressed[0] = undefined;\n\t\t\t\tbreak;\n\t\t\t\tcase 65:\t//A\n\t\t\t\tcase 87:\t//W\n\t\t\t\tcase 68:\t//D\n\t\t\t\tcase 83:\t//S\n\t\t\t\t\tthis.dirKeyPressed[1] = undefined;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tswitch (event.keyCode) {\n\t\t\tcase 32:\n\t\t\t\tthis.speed = 100;\n\t\t\tbreak;\n\t\t}\n\t}\n\tmousedownHandler=(e)=>{\n\t\tif (this.paused) {\n\t\t\treturn;\n\t\t}\n\t\tlet xpos = e.offsetX;\n\t\tlet ypos = e.offsetY;\n\t\tlet col = Math.floor(xpos/IMAGE_W);\n\t\tlet row = Math.floor(ypos/IMAGE_H);\n\t\tif (e.shiftKey) {\n\t\t\tthis.playerRoute[this.playerRouteInUse].push({col:col, row:row});\n\t\t} else {\n\t\t\tthis.playerRoute[this.playerRouteInUse] = [{col:col, row:row}];\n\t\t}\n\t}\n}\n","import { playAudio } from \"./misc\";\nimport {image,drawImage} from './image';\n\nexport class Apple{\n\ttype='Apple';\n\tpush=true;\n\teat=true;\n\tdestroy=true;\n\tonTick(stage, col, row){\n\t\tif (this.leaving) {\n\t\t\tthis.destroy = false;\n\t\t}\n\t}\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class AppleRotten{\n\ttype='AppleRotten';\n\tpush=true;\n\teat=true;\n\tdestroy=true;\n\ttimer = 1;\n\timg_index = 0;\n\tonDraw(ctx, col, row){\n\t\tthis.timer++;\n\t\tif (0 == (this.timer % 2)){\n\t\t\tthis.img_index = (0 == this.img_index ? 1 : 0);\n\t\t}\n\t\tdrawImage(image[this.type][this.img_index], ctx, col, row);\n\t}\n}\nexport class Ball{\n\ttype='Ball';\n\tpush = true;\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class Bomb{\n\ttype = 'Bomb';\n\tpush = true;\n\ttimeout = -1;\n\tdetonated = false;\n\tdoActivate() {\n\t\tif (this.timeout < 0) {\n\t\t\tthis.timeout = 160;\n\t\t}\n\t}\n\tdoDetonate(stage, col, row) {\n\t\tthis.push = undefined;\n\t\tthis.detonated = true;\n\t\tvar neighbour = stage.getNeighbour(col, row);\n\t\tvar len = neighbour.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar ncol = neighbour[i].col;\n\t\t\tvar nrow = neighbour[i].row;\n\t\t\tvar object = stage.getObject(ncol, nrow);\n\t\t\tif (undefined != object) {\n\t\t\t\tif (object.destroy) {\n\t\t\t\t\tstage.destroyObject(ncol, nrow);\n\t\t\t\t} else if (object.type == this.type) {\n\t\t\t\t\tobject.doActivate();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tneighbour.splice(0, neighbour.length);\n\t\t//delete neighbour;\n\n\t\tplayAudio('detonate');\n\t}\n\tonTick(stage, col, row) {\n\t\tvar moving = false;\n\t\tif (col < 0 || row < 0) {\n\t\t\tmoving = true;\n\t\t}\n\n\t\tif (moving && this.timeout < 0) {\n\t\t\tthis.doActivate();\n\t\t} else if (this.timeout > 0) {\n\t\t\tthis.timeout --;\n\t\t}\n\n\t\tif (0 == this.timeout) {\n\t\t\tif (this.detonated) {\n\t\t\t\tstage.setObject(col, row, undefined);\n\t\t\t} else if (!moving){\n\t\t\t\tthis.doDetonate(stage, col, row);\n\t\t\t}\n\t\t}\n\t}\n\tonDraw(ctx, col, row){\n\t\tif (this.timeout < 0) {\n\t\t\tdrawImage(image[this.type]['normal'], ctx, col, row);\n\t\t} else if (this.detonated) {\n\t\t\tdrawImage(image[this.type]['detonate'], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image[this.type]['ticking'][this.timeout % 2], ctx, col, row);\n\t\t}\n\t}\n}\nexport class Crystal{\n\ttype = 'Crystal';\n\tpush = true;\n\ttriggered = -1;\n\tTRIGGER = 35;\n\ttrigger(){\n\t\tif (-1 == this.triggered) {\n\t\t\tthis.triggered = this.TRIGGER;\n\t\t\tthis.push = undefined;\n\t\t}\n\t}\n\tonTick(stage, col, row){\n\t\tif (0 == this.triggered) {\n\t\t\tstage.destroyObject(col, row);\n\t\t\tstage.score += 200;\n\t\t\tplayAudio('crystal');\n\t\t\treturn;\n\t\t} else if (this.triggered > 0) {\n\t\t\t(this.triggered)--;\n\t\t} else {\n\t\t\tvar neighbour = stage.getNeighbour(col, row);\n\t\t\tvar len = neighbour.length;\n\t\t\tfor (var i = 0; i < len; i++) {\n\t\t\t\tvar object = stage.getObject(neighbour[i].col, neighbour[i].row);\n\t\t\t\tif (undefined != object && object.type == this.type) {\n\t\t\t\t\tif (object.triggered == -1 || object.triggered == this.TRIGGER){\n\t\t\t\t\t\tthis.trigger();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tneighbour.splice(0, neighbour.length);\n\t\t}\n\t}\n\tonDraw(ctx, col, row){\n\t\tif (this.triggered > 0) {\n\t\t\tdrawImage(image[this.type][this.triggered % 3], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image[this.type][0], ctx, col, row);\n\t\t}\n\t}\n}\nexport class Door{\n\ttype = 'Door';\n\tdestroy = true;\n\tonPick(player) {\n\t\tvar len = player.stage.data.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar object = player.stage.data[i];\n\t\t\tif (undefined == object) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tswitch (object.type){\n\t\t\t\tcase 'Key':\n\t\t\t\t\tobject.pick = true;\n\t\t\t\tbreak;\n\t\t\t\tcase 'Door':\n\t\t\t\t\tobject.pick = undefined;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class Egg{\n\ttype = 'Egg';\n\tpick = true;\n\teat = true;\n\tdestroy = true;\n\tonPick(player) {\n\t\tvar len = player.stage.data.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar object = player.stage.data[i];\n\t\t\tif (undefined != object && 'Flower' == object.type) {\n\t\t\t\tobject.poisonous = !object.poisonous;\n\t\t\t}\n\t\t}\n\t\tplayer.stage.score += 100;\n\t}\n\tonDraw(ctx, col, row) {\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n\tblackArea(stage, col, row) {\n\t\treturn [{col:col, row: row}];\n\t}\n}\nexport class Flower{\n\ttype = 'Flower';\n\tpick = true;\n\teat = true;\n\tdestroy = true;\n\tconstructor(poisonous){\n\t\tthis.poisonous = poisonous;\n\t}\n\tonPick(player) {\n\t\tif (this.poisonous) {\n\t\t\tplayer.poisoned = true;\n\t\t} else {\n\t\t\tplayer.stage.score += 50;\n\t\t}\n\t}\n\tonDraw(ctx, col, row) {\n\t\tif (this.poisonous) {\n\t\t\tdrawImage(image[this.type][1], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image[this.type][0], ctx, col, row);\n\t\t}\n\t}\n\tblackArea(stage, col, row) {\n\t\tif (this.poisonous) {\n\t\t\treturn [{col:col, row: row}];\n\t\t}\n\t\treturn [];\n\t}\n}\nexport class Key{\n\ttype = 'Key';\n\tpick = true;\n\tdestroy = true;\n\tonPick(player) {\n\t\tvar len = player.stage.data.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar object = player.stage.data[i];\n\t\t\tif (undefined == object) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tswitch (object.type){\n\t\t\t\tcase 'Key':\n\t\t\t\t\tobject.pick = undefined;\n\t\t\t\tbreak;\n\t\t\t\tcase 'Door':\n\t\t\t\t\tobject.pick = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class LaserGun{\n\ttype = 'LaserGun';\n\tdestroy = true;\n\tdetectedPos = new Array();\n\tblackAreaDetected = new Array();\n\n\tdoDetect(stage, col, row) {\n\t\tlet result = new Array();\n\t\tthis.blackAreaDetected.splice(0, this.blackAreaDetected.length);\n\n\t\t//North\n\t\tfor (var __row = row - 1; __row >= 0; __row--) {\n\t\t\tvar object = stage.getObject(col, __row);\n\t\t\tthis.blackAreaDetected.push({col:col, row:__row});\n\t\t\tif (undefined != object) {\n\t\t\t\tresult.push({col:col, row:__row, dir:DIR_NORTH});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//East\n\t\tfor (var __col = col + 1; __col < stage.cols; __col++) {\n\t\t\tvar object = stage.getObject(__col, row);\n\t\t\tthis.blackAreaDetected.push({col:__col, row:row});\n\t\t\tif (undefined != object) {\n\t\t\t\tresult.push({col:__col, row:row, dir:DIR_EAST});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//West\n\t\tfor (var __col = col - 1; __col >= 0; __col--) {\n\t\t\tvar object = stage.getObject(__col, row);\n\t\t\tthis.blackAreaDetected.push({col:__col, row:row});\n\t\t\tif (undefined != object) {\n\t\t\t\tresult.push({col:__col, row:row, dir:DIR_WEST});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//South\n\t\tfor (var __row = row + 1; __row < stage.rows; __row++) {\n\t\t\tvar object = stage.getObject(col, __row);\n\t\t\tthis.blackAreaDetected.push({col:col, row:__row});\n\t\t\tif (undefined != object) {\n\t\t\t\tresult.push({col:col, row:__row, dir:DIR_SOUTH});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (result.length > 0 ? result : undefined);\n\t}\n\tsetupLaser(stage, col, row, posDetected){\n\t\tswitch (posDetected.dir) {\n\t\t\tcase DIR_NORTH:\n\t\t\t\tfor (var y = row - 1; y > posDetected.row; y--) {\n\t\t\t\t\tstage.setObject(col, y, new SpacerLaser(DIR_NORTH));\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_EAST:\n\t\t\t\tfor (var x = col + 1; x < posDetected.col; x++) {\n\t\t\t\t\tstage.setObject(x, row, new SpacerLaser(DIR_EAST));\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_WEST:\n\t\t\t\tfor (var x = col - 1; x > posDetected.col; x--) {\n\t\t\t\t\tstage.setObject(x, row, new SpacerLaser(DIR_WEST));\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_SOUTH:\n\t\t\t\tfor (var y = row + 1; y < posDetected.row; y++) {\n\t\t\t\t\tstage.setObject(col, y, new SpacerLaser(DIR_SOUTH));\n\t\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tplayAudio('lasershot');\n\t}\n\tonTick(stage, col, row) {\n\t\tthis.detectedPos = this.doDetect(stage, col, row);\n\t\tif (undefined != this.detectedPos) {\n\t\t\tfor (var i = 0; i < this.detectedPos.length; i++) {\n\t\t\t\tvar pos = this.detectedPos[i];\n\t\t\t\tvar object = stage.getObject(pos.col, pos.row);\n\t\t\t\tif (undefined != object && 'SpacerPlayer' == object.type\n\t\t\t\t\t&& object.src.invisible <= 0\n\t\t\t\t\t&& !object.leaving && !object.src.Moveable.isMoving()) {\n\t\t\t\t\tstage.setObject(pos.col, pos.row,\n\t\t\t\t\t\tnew SpacerPlayerPoisoned(object.src));\n\t\t\t\t\tstage.destroyPlayer(object.src);\n\t\t\t\t\tthis.setupLaser(stage, col, row, pos);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.detectedPos.splice(0, this.detectedPos.length);\n\t}\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n\tblackArea(stage, col, row) {\n\t\treturn this.blackAreaDetected;\n\t}\n}\nexport class Mushroom{\n\ttype = 'Mushroom';\n\tpick = true;\n\teat = true;\n\tdestroy = true;\n\tconstructor(poisonous){\n\t\tthis.poisonous = poisonous;\n\t}\n\tonPick(player) {\n\t\tif (this.poisonous) {\n\t\t\tplayer.poisoned = true;\n\t\t} else {\n\t\t\tplayer.stage.score += 500;\n\t\t\tplayer.finished = true;\n\t\t}\n\t}\n\tonDraw(ctx, col, row) {\n\t\tif (this.poisonous) {\n\t\t\tdrawImage(image[this.type][1], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image[this.type][0], ctx, col, row);\n\t\t}\n\t}\n\tblackArea(stage, col, row) {\n\t\tif (this.poisonous) {\n\t\t\treturn [{col:col, row:row}];\n\t\t}\n\t\treturn [];\n\t}\n}\nexport class PFlower{\n\ttype = 'PFlower';\n\teat = true;\n\tdestroy = true;\n\topen = 0;\n\tdigest = 0;\n\tgrab = {\n\t\ttype: undefined,\n\t\tdir: undefined,\n\t\ttimeout: 0,\n\t\tspacerCol: undefined,\n\t\tspacerRow: undefined,\n\t};\n\tconstructor(opened){\n\t\t/* Values of this.status:\n\t\t * 'C' : Flower closed\n\t\t * 'o' : Flower opening\n\t\t * 'O' : Flower opened\n\t\t * 'G' : Flower grabbing object\n\t\t * 'D' : Flower digesting\n\t\t */\n\t\tthis.status = (opened ? 'O' : 'C');\n\t}\n\tdoOpen(){\n\t\tif ('C' == this.status) {\n\t\t\tthis.open = image[this.type]['open'].length;\n\t\t\tthis.status = 'o';\n\t\t}\n\t}\n\tdoDigest(stage, col, row) {\n\t\tthis.status = 'D';\n\t\tstage.setObject(this.grab.spacerCol, this.grab.spacerRow, undefined);\n\t\tswitch (this.grab.type) {\n\t\t\tcase 'Player':\n\t\t\t\tthis.digest = -1;\n\t\t\tbreak;\n\t\t\tcase 'Apple':\n\t\t\t\tthis.digest = 160;\n\t\t\tbreak;\n\t\t\tcase 'AppleRotten':\n\t\t\t\tthis.digest = 1600;\n\t\t\tbreak;\n\t\t}\n\t}\n\tdoDetect(stage, col, row, type) {\n\t\tvar result = undefined;\n\t\t//Check whether a player is nearby\n\t\tvar neighbour = stage.getNeighbour(col, row);\n\t\tvar len = neighbour.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar object = stage.getObject(neighbour[i].col, neighbour[i].row);\n\t\t\tif (undefined != object && object.type == type){\n\t\t\t\tif (type == 'SpacerPlayer') {\n\t\t\t\t\tlet player = object.src;\n\t\t\t\t\tif (player.invisible <= 0) {\n\t\t\t\t\t\tresult = {\n\t\t\t\t\t\t\ttype: object.type,\n\t\t\t\t\t\t\tobject: object,\n\t\t\t\t\t\t\tcol: neighbour[i].col,\n\t\t\t\t\t\t\trow: neighbour[i].row,\n\t\t\t\t\t\t\tdir: neighbour[i].dir,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresult = {\n\t\t\t\t\t\ttype: object.type,\n\t\t\t\t\t\tobject: object,\n\t\t\t\t\t\tcol: neighbour[i].col,\n\t\t\t\t\t\trow: neighbour[i].row,\n\t\t\t\t\t\tdir: neighbour[i].dir,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tneighbour.splice(0, neighbour.length);\n\t\treturn result;\n\t}\n\tdoGrab(stage, col, row, detected) {\n\t\tthis.status = 'G';\n\t\tstage.setObject(detected.col, detected.row, new SpacerPFlower(detected.dir, detected.type));\n\t\tthis.grab.type = detected.type;\n\t\tthis.grab.dir = detected.dir;\n\t\tthis.grab.spacerCol = detected.col;\n\t\tthis.grab.spacerRow = detected.row;\n\t\tthis.grab.timeout = 4;\n\t\tplayAudio('grab');\n\t}\n\tonTick(stage, col, row) {\n\t\tswitch (this.status) {\n\t\t\tcase 'C':\n\t\t\t\tvar detected = this.doDetect(stage, col, row, 'SpacerPlayer');\n\t\t\t\tif (undefined != detected && !detected.object.src.Moveable.isMoving()) {\n\t\t\t\t\tthis.doOpen();\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase 'o':\n\t\t\t\tthis.open--;\n\t\t\t\tif (this.open <= 0) {\n\t\t\t\t\tthis.status = 'O';\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase 'O':\n\t\t\t\tvar detected = undefined;\n\t\t\t\tdo {\n\t\t\t\t\tdetected = this.doDetect(stage, col, row, 'SpacerPlayer');\n\t\t\t\t\tif (undefined != detected\n\t\t\t\t\t\t&& !detected.object.leaving\n\t\t\t\t\t\t&& !detected.object.src.Moveable.isMoving()) {\n\t\t\t\t\t\tstage.destroyPlayer(detected.object.src);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tdetected = this.doDetect(stage, col, row, 'Apple');\n\t\t\t\t\tif (undefined != detected) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tdetected = this.doDetect(stage, col, row, 'AppleRotten');\n\t\t\t\t\tif (undefined != detected) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t//Nothing valuable detected\n\t\t\t\t\tdetected = undefined;\n\t\t\t\t}while(0);\n\t\t\t\tif (undefined != detected) {\n\t\t\t\t\tthis.doGrab(stage, col, row, detected);\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase 'G':\n\t\t\t\tthis.grab.timeout--;\n\t\t\t\tif (0 == this.grab.timeout) {\n\t\t\t\t\tthis.doDigest(stage, col, row);\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase 'D':\n\t\t\t\tif (this.digest > 0) {\n\t\t\t\t\tthis.digest--;\n\t\t\t\t\tif (0 == this.digest) {\n\t\t\t\t\t\tthis.status = 'C';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\tonDraw(ctx, col, row) {\n\t\tvar img, frameCount, frameSpace, frame;\n\t\tswitch (this.status) {\n\t\t\tcase 'C':\n\t\t\t\timg = image[this.type]['digest'][0];\n\t\t\tbreak;\n\t\t\tcase 'o':\n\t\t\t\tframeCount = image[this.type]['open'].length;\n\t\t\t\tframe = (this.open >= 0 ? this.open : 0);\n\t\t\t\tframe = (frame < frameCount ? frame : frameCount - 1);\n\t\t\t\timg = image[this.type]['open'][frame];\n\t\t\tbreak;\n\t\t\tcase 'O':\n\t\t\t\timg = image[this.type]['open'][0];\n\t\t\tbreak;\n\t\t\tcase 'G':\n\t\t\t\timg = image[this.type]['grab'][this.grab.dir];\n\t\t\tbreak;\n\t\t\tcase 'D':\n\t\t\t\tframeCount = image[this.type]['digest'].length;\n\t\t\t\tswitch (this.grab.type) {\n\t\t\t\t\tcase 'Apple':\n\t\t\t\t\t\tframe = Math.ceil(this.digest / 40);\n\t\t\t\t\t\tframe = (frame < frameCount ? frame : frameCount - 1);\n\t\t\t\t\t\timg = image[this.type]['digest'][frame];\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'AppleRotten':\n\t\t\t\t\t\tframe = Math.ceil(this.digest / 400);\n\t\t\t\t\t\tframe = (frame < frameCount ? frame : frameCount - 1);\n\t\t\t\t\t\timg = image[this.type]['digest'][frame];\n\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tframe = Math.floor(Math.random() * 3);\n\t\t\t\t\t\timg = image[this.type]['player'][frame];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t\t//Finally draw the image\n\t\tdrawImage(img, ctx, col, row);\n\t}\n\tblackArea(stage, col, row) {\n\t\tvar result = new Array();\n\t\tvar neighbour = stage.getNeighbour(col, row, undefined);\n\t\tfor (var i = 0; i < neighbour.length; i++) {\n\t\t\tresult.push({col:neighbour[i].col, row:neighbour[i].row});\n\t\t}\n\t\tresult.push({col:col, row: row});\n\t\tneighbour.splice(0, neighbour.length);\n\t\treturn result;\n\t}\n}\nexport class Pill {\n\ttype = 'Pill';\n\tpick = true;\n\teat = true;\n\tdestroy = true;\n\tonPick(player) {\n\t\tplayer.invisible += 200;\n\t}\n\tonDraw(ctx, col, row) {\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class SpacerDemon{\n\ttype = 'SpacerDemon';\n\tdestroy = true;\n\tleaving = false;\n\tconstructor(src){\n\t\tthis.src = src;\n\t}\n\tonDestroy(stage, col, row) {\n\t\tif (!this.leaving) {\n\t\t\tvar demon = this.src;\n\t\t\tif (undefined != demon.Moveable.colPrev\n\t\t\t\t&& undefined != demon.Moveable.rowPrev) {\n\t\t\t\tstage.setObject(demon.Moveable.colPrev, demon.Moveable.rowPrev, undefined);\n\t\t\t}\n\t\t\tstage.destroyDemon(demon);\n\t\t}\n\t}\n\tonTick(stage, col, row){\n\t\tif (this.leaving) {\n\t\t\tthis.destroy = false;\n\t\t}\n\t}\n\t/*\n\tthis.onDraw = function (ctx, col, row) {\n\t\tif (this.leaving){\n\t\t\tdrawImage(image['AppleRotten'][0], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image['Apple'], ctx, col, row);\n\t\t}\n\t}\n\t*/\n}\nexport class SpacerLaser{\n\ttype = 'SpacerLaser';\n\ttimeout = 3;\n\tconstructor(dir){\n\t\tthis.dir=dir;\n\t}\n\tonTick(stage, col, row) {\n\t\tthis.timeout--;\n\t\tif (this.timeout <= 0) {\n\t\t\tstage.setObject(col, row, undefined);\n\t\t}\n\t}\n\tonDraw(ctx, col, row) {\n\t\tvar img;\n\t\tswitch(this.dir) {\n\t\t\tcase DIR_NORTH:\n\t\t\tcase DIR_SOUTH:\n\t\t\t\tdrawImage(image[this.type][1], ctx, col, row);\n\t\t\tbreak;\n\t\t\tcase DIR_EAST:\n\t\t\tcase DIR_WEST:\n\t\t\t\tdrawImage(image[this.type][0], ctx, col, row);\n\t\t\tbreak;\n\t\t}\n\t}\n}\nexport class SpacerObject{\n\ttype = 'SpacerObject';\n\tconstructor(src){\n\t\tthis.src = src;\n\t}\n}\nexport class SpacerPFlower{\n\ttype = 'SpacerPFlower';\n\ttimeout = 24;\n\tconstructor(dir, type){\n\t\tthis.dir = dir;\n\t\tthis.typeGrabbed = type;\n\t}\n\tonTick(stage, col, row) {\n\t\tthis.timeout--;\n\t\tif (this.timeout <= 0) {\n\t\t\tstage.setObject(col, row, undefined);\n\t\t}\n\t}\n\tonDraw(ctx, col, row) {\n\t\tlet img;\n\t\tswitch (this.typeGrabbed) {\n\t\t\tcase 'SpacerPlayer':\n\t\t\t\timg = image[this.type]['grabPlayer'][this.dir];\n\t\t\tbreak;\n\t\t\tcase 'Apple':\n\t\t\tcase 'AppleRotten':\n\t\t\t\timg = image[this.type]['grabApple'][this.dir];\n\t\t\tbreak;\n\t\t}\n\t\tdrawImage(img, ctx, col, row);\n\t}\n}\nexport class SpacerPlayer{\n\ttype = 'SpacerPlayer';\n\teat = true;\n\tdestroy = true;\n\tleaving = false;\n\tconstructor(src){\n\t\tthis.src = src;\n\t}\n\tonEat(demon, stage, col, row) {\n\t\tif (!this.leaving) {\n\t\t\tif(!this.src.poisoned){\n\t\t\t\tplayAudio('bitten');\n\t\t\t}\n\t\t\tthis.src.poisoned = true;\n\t\t}\n\t}\n\tonDestroy(stage, col, row) {\n\t\tvar player = this.src;\n\t\tif (undefined != player.Moveable.colPrev\n\t\t\t&& undefined != player.Moveable.rowPrev) {\n\t\t\tstage.setObject(player.Moveable.colPrev, player.Moveable.rowPrev, undefined);\n\t\t}\n\t\tstage.destroyPlayer(player);\n\t}\n\tonTick(stage, col, row){\n\t\tif (this.leaving) {\n\t\t\tthis.destroy = this.eat = false;\n\t\t} else {\n\t\t\tthis.destroy = this.eat = true;\n\t\t}\n\t}\n}\nexport class SpacerPlayerPoisoned{\n\ttype = 'SpacerPlayerPoisoned';\n\ttimeout = 30;\n\tconstructor(player){\n\t\tthis.player=player;\n\t\tthis.dir = player.Moveable.dir;\n\t}\n\tonTick(stage, col, row) {\n\t\tif (0 == this.timeout) {\n\t\t\tstage.destroyObject(col, row);\n\t\t\treturn;\n\t\t}\n\t\tthis.timeout--;\n\t}\n\tonDraw(ctx, col, row){\n\t\tvar __type = (this.player.girl ? 'PlayerGirl' : 'Player');\n\t\tif (this.timeout > 20) {\n\t\t\tdrawImage(image[__type][this.dir][0], ctx, col, row);\n\t\t} else {\n\t\t\tdrawImage(image[__type]['poisoned'][this.timeout > 12 ? 12 : this.timeout], ctx, col, row);\n\t\t}\n\n\t\tif (20 == this.timeout) {\n\t\t\tplayAudio('poisoned');\n\t\t}\n\t}\n}\nexport class Treasure{\n\ttype = 'Treasure';\n\tpick = true;\n\tdestroy = true;\n\tonPick(player) {\n\t\tplayer.stage.score += 1000;\n\t}\n\tonDraw(ctx, col, row) {\n\t\tdrawImage(image[this.type], ctx, col, row);\n\t}\n}\nexport class Wall{\n\ttype = 'Wall';\n\tconstructor(style){\n\t\tthis.style=style;\n\t}\n\tonDraw(ctx, col, row){\n\t\tdrawImage(image[this.type][this.style], ctx, col, row);\n\t}\n}\n","import {image,drawImage} from './image';\nimport {switchDir,Moveable} from './misc';\nimport { SpacerDemon } from './object';\n\nexport function leftFirst(demon) {\n\tvar dir = demon.Moveable.dir;\n\treturn [\n\t\tdir,\n\t\tswitchDir(dir, DIR_LEFT),\n\t\tswitchDir(dir, DIR_RIGHT),\n\t\tswitchDir(dir, DIR_BACK),\n\t];\n}\nexport function rightFirst(demon) {\n\tvar dir = demon.Moveable.dir;\n\treturn [\n\t\tdir,\n\t\tswitchDir(dir, DIR_RIGHT),\n\t\tswitchDir(dir, DIR_LEFT),\n\t\tswitchDir(dir, DIR_BACK),\n\t];\n}\nexport function randomSelection(demon) {\n\tvar dir = demon.Moveable.dir;\n\tif (Math.random() >= 0.5) {\n\t\treturn [\n\t\t\tdir,\n\t\t\tswitchDir(dir, DIR_LEFT),\n\t\t\tswitchDir(dir, DIR_RIGHT),\n\t\t\tswitchDir(dir, DIR_BACK),\n\t\t];\n\t} else {\n\t\treturn [\n\t\t\tdir,\n\t\t\tswitchDir(dir, DIR_RIGHT),\n\t\t\tswitchDir(dir, DIR_LEFT),\n\t\t\tswitchDir(dir, DIR_BACK),\n\t\t];\n\t}\n}\nexport function randomTurn(demon) {\n\tvar result = [DIR_NORTH, DIR_EAST, DIR_WEST, DIR_SOUTH];\n\tfor (var i = 1; i < result.length; i++) {\n\t\tvar irand = Math.floor(Math.random() * (i + 1));\n\t\tvar temp = result[irand];\n\t\tresult[irand] = result[i];\n\t\tresult[i] = temp;\n\t}\n\treturn result;\n}\nexport default class Demon{\n\ttype = 'Demon';\n\tturning = leftFirst;\n\tconstructor(stage, col, row, initDir){\n\t\tthis.Moveable = new Moveable(col, row, initDir);\n\t\tthis.stage = stage;\n\t\tthis.stage.setObject(col, row, new SpacerDemon(this));\n\t\tthis.dir = initDir;\n\t}\n\tmove(dir){\n\t\t//Demon is already moving\n\t\tif (this.Moveable.step > 0) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t//Change the direction of the demon\n\t\tthis.Moveable.dir = dir;\n\n\t\t//Finally move the daemon\n\t\tthis.Moveable.move(dir);\n\t\tthis.stage.setObject(this.Moveable.col, this.Moveable.row, new SpacerDemon(this));\n\t\tthis.stage.getObject(this.Moveable.colPrev, this.Moveable.rowPrev).leaving = true;\n\t\treturn true;\n\t}\n\tonTick(stage) {\n\t\tif (this.Moveable.isMoving()){\n\t\t\tvar result = this.Moveable.onTick();\n\t\t\tthis.dir = this.Moveable.dir;\n\t\t\tif (undefined != result) {\t//Demon has just finished moving\n\t\t\t\tthis.stage.setObject(result.colPrev, result.rowPrev, undefined);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tlet dirArray = this.turning(this), surrounded=true;\n\n\t\t//If a demon is surrended by objects, then check whether the object in front of the demon is eatable\n\t\tfor(let dir of dirArray){\n\t\t\tlet pos = stage.getNeighbour(this.Moveable.col, this.Moveable.row, dir);\n\t\t\tif (undefined == pos) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet object = stage.getObject(pos.col, pos.row);\n\t\t\tif(!object){\n\t\t\t\tsurrounded=false;\n\t\t\t}\n\t\t}\n\t\tif(surrounded){\n\t\t\t//Get the object in front\n\t\t\tlet pos = stage.getNeighbour(this.Moveable.col, this.Moveable.row, this.dir);\n\t\t\tif(!pos){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet object = stage.getObject(pos.col, pos.row);\n\t\t\tif(object && !/Spacer.*/.test(object.type) && object.eat){\n\t\t\t\t//Execute trigger onEat()\n\t\t\t\tobject.onEat && object.onEat(this, stage, pos.col, pos.row);\n\t\t\t\t//Destroy the object!!!\n\t\t\t\tstage.destroyObject(pos.col, pos.row);\n\t\t\t\tif (this.move(this.dir)) {\n\t\t\t\t\tthis.Moveable.step--;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tfor (var i in dirArray) {\n\t\t\tthis.dir = dirArray[i];\n\t\t\tvar pos = stage.getNeighbour(this.Moveable.col, this.Moveable.row, dirArray[i]);\n\t\t\t//Edge reached\n\t\t\tif (undefined == pos) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar object = stage.getObject(pos.col, pos.row);\n\t\t\tif (undefined != object) {\n\t\t\t\t//If a spacer is in front, the demon will stop until the spacer disappears, Except demon\n\t\t\t\tif (/Spacer.*/.test(object.type)) {\n\t\t\t\t\t//Execute trigger onEat()\n\t\t\t\t\tif (true == object.eat && undefined != object.onEat) {\n\t\t\t\t\t\tobject.onEat(this, stage, pos.col, pos.row);\n\t\t\t\t\t}\n\t\t\t\t\tif (object.type != 'SpacerDemon') {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//The object detected is not eatable\n\t\t\t\tif (true != object.eat) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t//Execute trigger onEat()\n\t\t\t\tif (undefined != object.onEat) {\n\t\t\t\t\tobject.onEat(this, stage, pos.col, pos.row);\n\t\t\t\t}\n\t\t\t\t//Destroy the object!!!\n\t\t\t\tstage.destroyObject(pos.col, pos.row);\n\t\t\t}\n\t\t\tif (this.move(dirArray[i])) {\n\t\t\t\tthis.Moveable.step--;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tonDraw(ctx) {\n\t\tvar idx_img = [0, 1, 0, 2, 0, 1, 0, 2, 0];\n\t\tvar img = image[this.type][this.dir][idx_img[this.Moveable.step]];\n\t\tthis.Moveable.onDraw(img, ctx);\n\t}\n}\n\n","'use strict'\n\nimport Level from './level';\nimport Stage from './stage';\nimport Demon from './demon';\nimport {\n\tleftFirst,\n\trightFirst,\n\trandomSelection,\n\trandomTurn\n} from './demon';\nimport Player from './player';\nimport {\n\tApple,\n\tAppleRotten,\n\tBall,\n\tBomb,\n\tCrystal,\n\tDoor,\n\tEgg,\n\tFlower,\n\tKey,\n\tLaserGun,\n\tMushroom,\n\tPFlower,\n\tPill,\n\tTreasure,\n\tWall\n} from './object';\nimport {\n\tDIR_NORTH,\n\tDIR_EAST,\n\tDIR_WEST,\n\tDIR_SOUTH,\n\tDIR_LEFT,\n\tDIR_RIGHT,\n\tDIR_BACK,\n} from './misc';\nimport{\n\tIMAGE_W,\n\tIMAGE_H,\n} from './image';\n\nObject.assign(window,{\n\tStage,\n\tPlayer,\n\tDemon,\n\tApple,\n\tAppleRotten,\n\tBall,\n\tBomb,\n\tCrystal,\n\tDoor,\n\tEgg,\n\tFlower,\n\tKey,\n\tLaserGun,\n\tMushroom,\n\tPFlower,\n\tPill,\n\tTreasure,\n\tWall,\n\tIMAGE_W,\n\tIMAGE_H,\n\tDIR_NORTH,\n\tDIR_EAST,\n\tDIR_WEST,\n\tDIR_SOUTH,\n\tDIR_LEFT,\n\tDIR_RIGHT,\n\tDIR_BACK,\n\tleftFirst,\n\trightFirst,\n\trandomSelection,\n\trandomTurn,\n});\n\nfunction puzzlePackFinished(packName, totalScore){\n\tdocument.querySelector('canvas#stage').style.display='none';\n\tdocument.querySelector('div#footer').style.display='none';\n\tdocument.querySelector('div#gamefinished').style.display='block';\n\tdocument.querySelector('div#gamefinished h1#totalscore').innerHTML=totalScore;\n\t//Replay puzzle pack\n\ttry{\n\t\tlet storageData=localStorage.getItem('puzzleProcess');\n\t\tif(storageData){\n\t\t\tstorageData=JSON.parse(storageData);\n\t\t\tdelete storageData[packName + '_Level'];\n\t\t\tdelete storageData[packName + '_Score'];\n\t\t\tlocalStorage.setItem('puzzleProcess',JSON.stringify(storageData));\n\t\t}\n\t}catch(e){\n\t\tconsole.error(e);\n\t}\n}\nexport default function(packName, levelData) {\n\tvar ctx = document.querySelector('canvas#stage').getContext('2d');\n\tvar totalScore = 0;\n\tvar levelNum = 0;\n\n\t//Disable sound by default\n\tdocument.querySelector('input#enableSound').checked = false;\n\tdocument.querySelector('input#enableSound').addEventListener('change',(e)=>{\n\t\tlet settingData=localStorage.getItem('gameSetting');\n\t\tsettingData = settingData ? JSON.parse(settingData) : {};\n\t\tsettingData.soundOn=e.target.checked;\n\t\tlocalStorage.setItem('gameSetting',JSON.stringify(settingData));\n\t\te.target.blur();\n\t});\n\n\t//Read sound on/off from localStorage\n\ttry{\n\t\tlet settingData=localStorage.getItem('gameSetting');\n\t\tif(settingData){\n\t\t\tsettingData=JSON.parse(settingData);\n\t\t\tdocument.querySelector('input#enableSound').checked = settingData.soundOn;\n\t\t}\n\t}catch(e){\n\t\tconsole.error(e);\n\t}\n\n\t//Get puzzle pack stored data\n\ttry{\n\t\tlet storageData=localStorage.getItem('puzzleProcess');\n\t\tif(storageData){\n\t\t\tstorageData=JSON.parse(storageData);\n\t\t\ttotalScore=storageData[packName + '_Score'] || undefined;\n\t\t\tlevelNum=storageData[packName + '_Level'] || undefined;\n\t\t}\n\t}catch(e){\n\t\tconsole.error(e);\n\t}\n\tif (undefined != totalScore && !isNaN(totalScore)) {\n\t\ttotalScore = Number(totalScore);\n\t}\n\tif (undefined != levelNum && !isNaN(levelNum)) {\n\t\tlevelNum = Number(levelNum);\n\t} else {\n\t\tlevelNum = totalScore = 0;\n\t}\n\n\t//Game already finished\n\tif (levelNum >= levelData.length) {\n\t\tpuzzlePackFinished(packName, totalScore);\n\t\treturn;\n\t} \n\n\t//Start game\n\tvar level = new Level(levelData[levelNum], ctx);\n\tdocument.querySelector('span#level').innerHTML=(levelNum + 1);\n\tconst onFinish=function(levelScore){\n\t\ttotalScore += levelScore;\n\t\tlevelNum++;\n\t\ttry{\n\t\t\tlet storageData=localStorage.getItem('puzzleProcess');\n\t\t\tif(storageData){\n\t\t\t\tstorageData=JSON.parse(storageData);\n\t\t\t}else{\n\t\t\t\tstorageData={};\n\t\t\t}\n\t\t\tstorageData[packName + '_Level']=levelNum;\n\t\t\tstorageData[packName + '_Score']=totalScore;\n\t\t\tlocalStorage.setItem('puzzleProcess',JSON.stringify(storageData));\n\t\t}catch(e){\n\t\t\tconsole.error(e);\n\t\t}\n\t\tif (levelNum < levelData.length) {\n\t\t\t//Next level\n\t\t\tlevel = new Level(levelData[levelNum], ctx);\n\t\t\tlevel.onFinish(onFinish);\n\t\t\tdocument.querySelector('span#level').innerHTML=(levelNum + 1);\n\t\t} else {\n\t\t\t//Game finished\n\t\t\tlevel = undefined;\n\t\t\tpuzzlePackFinished(packName, totalScore);\n\t\t}\n\t}\n\tlevel.onFinish(onFinish);\n}\n","import {image,drawImage} from './image';\nexport default class Stage{\n\tname = '';\n\tcols = 17;\n\trows = 12;\n\n\tdata = new Array(17 * 12);\n\tplayer = new Array();\n\tdemon = new Array();\n\n\tposDestroyed = new Array();\n\tfinished = false;\n\tscore = 0;\n\n\tconstructor(initfunc){\n\t\t//Init the stage\n\t\tif (undefined != initfunc) {\n\t\t\tthis.initfunc=initfunc;\n\t\t\tinitfunc(this);\n\t\t}\n\t}\n\n\tgetObject(col, row){\n\t\treturn this.data[row * this.cols + col];\n\t}\n\tsetObject(col, row, object){\n\t\tdelete this.data[row * this.cols + col];\n\t\tthis.data[row * this.cols + col] = object;\n\t}\n\tdestroyObject(col, row){\n\t\tvar object = this.getObject(col, row);\n\t\tif (undefined != object) {\n\t\t\tif (undefined != object.onDestroy) {\n\t\t\t\tobject.onDestroy(this, col, row);\n\t\t\t}\n\t\t\tthis.posDestroyed.push([col, row]);\n\t\t\tthis.setObject(col, row, undefined);\n\t\t}\n\t}\n\tdestroyPlayer(playerObj) {\n\t\tthis.player[this.player.indexOf(playerObj)] = null;\n\t\tthis.player[this.player.indexOf(playerObj)] = undefined;\n\t\tplayerObj = null;\n\t}\n\tdestroyDemon(demonObj) {\n\t\tthis.demon[this.demon.indexOf(demonObj)] = null;\n\t\tthis.demon[this.demon.indexOf(demonObj)] = undefined;\n\t\tdemonObj = null;\n\t}\n\n\tgetNeighbour(col, row, dir) {\n\t\tswitch (dir) {\n\t\t\tcase DIR_NORTH:\n\t\t\t\tif (row > 0) {\n\t\t\t\t\treturn {col:col, row:(row - 1)};\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_EAST:\n\t\t\t\tif (col < (this.cols - 1)) {\n\t\t\t\t\treturn {col:(col + 1), row:row};\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_WEST:\n\t\t\t\tif (col > 0) {\n\t\t\t\t\treturn {col:(col - 1), row:row};\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tcase DIR_SOUTH:\n\t\t\t\tif (row < (this.rows - 1)) {\n\t\t\t\t\treturn {col:col, row:(row + 1)};\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tvar result = new Array();\n\t\t\t\t//North\n\t\t\t\tif (row > 0) {\n\t\t\t\t\tresult.push({col:col, row:(row - 1), dir:DIR_NORTH});\n\t\t\t\t}\n\t\t\t\t//East\n\t\t\t\tif (col < (this.cols - 1)) {\n\t\t\t\t\tresult.push({col:(col + 1), row:row, dir:DIR_EAST});\n\t\t\t\t}\n\t\t\t\t//West\n\t\t\t\tif (col > 0) {\n\t\t\t\t\tresult.push({col:(col - 1), row:row, dir:DIR_WEST});\n\t\t\t\t}\n\t\t\t\t//South\n\t\t\t\tif (row < (this.rows - 1)) {\n\t\t\t\t\tresult.push({col:col, row:(row + 1), dir:DIR_SOUTH});\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\ttick(ctx) {\n\t\t//Players\n\t\tvar len = this.player.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tif (undefined != this.player[i]) {\n\t\t\t\tthis.player[i].onTick(this);\n\t\t\t}\n\t\t}\n\n\t\t//Demons\n\t\tvar len = this.demon.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tif (undefined != this.demon[i]) {\n\t\t\t\tthis.demon[i].onTick(this);\n\t\t\t}\n\t\t}\n\n\t\t//Objects on the stage\n\t\tfor (var row = 0; row < this.rows; row++) {\n\t\t\tfor (var col = 0; col < this.cols; col++) {\n\t\t\t\tlet object = this.data[row * this.cols + col];\n\t\t\t\tif (undefined != object && undefined != object.onTick) {\n\t\t\t\t\tobject.onTick(this, col, row);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tdraw(ctx) {\n\t\t//Draw objects on the stage\n\t\tfor (var row = 0; row < this.rows; row++) {\n\t\t\tfor (var col = 0; col < this.cols; col++) {\n\t\t\t\tlet object = this.data[row * this.cols + col];\n\t\t\t\tif (undefined == object || undefined == object.onDraw) {\n\t\t\t\t\tdrawImage(image[undefined], ctx, col, row);\n\t\t\t\t} else {\n\t\t\t\t\tobject.onDraw(ctx, col, row);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//Draw destroyed objects\n\t\tvar len = this.posDestroyed.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tcol = this.posDestroyed[i][0];\n\t\t\trow = this.posDestroyed[i][1];\n\t\t\tdrawImage(image['Destroyed'], ctx, col, row);\n\t\t}\n\t\tdelete this.posDestoryed;\n\t\tthis.posDestroyed = [];\n\n\t\t//Draw player and demon\n\t\tvar len = this.demon.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tif (undefined != this.demon[i]) {\n\t\t\t\tthis.demon[i].onDraw(ctx);\n\t\t\t}\n\t\t}\n\t\tvar len = this.player.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tif (undefined != this.player[i]) {\n\t\t\t\tthis.player[i].onDraw(ctx);\n\t\t\t}\n\t\t}\n\t}\n\treset(){\n\t\tdelete this.data;\n\t\tdelete this.player;\n\t\tdelete this.demon;\n\t\tdelete this.posDestoryed;\n\t\tthis.data = new Array(this.rows * this.cols);\n\t\tthis.player = new Array();\n\t\tthis.demon = new Array();\n\t\tthis.posDestroyed = new Array();\n\t\tthis.finished = false;\n\t\tthis.score = 0;\n\t\tif (undefined != this.initfunc) {\n\t\t\tthis.initfunc(this);\n\t\t}\n\t}\n}\n\n","import {image,drawImage} from './image';\nimport { playAudio,Moveable } from \"./misc\";\nimport { SpacerPlayer, SpacerObject, SpacerPlayerPoisoned } from \"./object\";\n\nexport default class Player{\n\ttype = 'Player';\n\tfinished = false;\n\tpoisoned = false;\n\tobjectPushing = undefined;\n\tinvisible = 0;\n\tsleepy = 0;\n\tconstructor(stage, col, row, isGirl){\n\t\tthis.Moveable = new Moveable(col, row, DIR_SOUTH);\n\t\tthis.girl = isGirl;\n\t\tthis.stage = stage;\n\t\tthis.stage.setObject(col, row, new SpacerPlayer(this));\n\t}\n\tonTick(stage) {\n\t\tvar result = this.Moveable.onTick();\n\t\tif (undefined != result) {\t//Player has just finished moving\n\t\t\tthis.stage.setObject(result.colPrev, result.rowPrev, undefined);\n\t\t\tif (undefined != this.objectPushing) {\n\t\t\t\tvar objectPos = this.stage.getNeighbour(\n\t\t\t\t\tthis.Moveable.col, this.Moveable.row, this.Moveable.dir);\n\t\t\t\tthis.stage.setObject(objectPos.col, objectPos.row , this.objectPushing);\n\t\t\t\tthis.objectPushing = undefined;\n\t\t\t}\n\t\t}\n\t\tif (undefined != result || !this.Moveable.isMoving()) {\n\t\t\t//Player is poisoned\n\t\t\tif (this.poisoned == true) {\n\t\t\t\tthis.stage.setObject(this.Moveable.col, this.Moveable.row,\n\t\t\t\t\tnew SpacerPlayerPoisoned(this));\n\t\t\t\tthis.stage.destroyPlayer(this);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//Player finished\n\t\t\tif (this.finished) {\n\t\t\t\tthis.stage.finished = true;\n\t\t\t}\n\t\t}\n\n\t\tif (undefined != this.objectPushing\n\t\t\t&& undefined != this.objectPushing.onTick) {\n\t\t\tthis.objectPushing.onTick(this.stage, -1, -1);\n\t\t}\n\n\t\t//Other thigs\n\t\tif (this.invisible > 0) {\n\t\t\tthis.invisible--;\n\t\t}\n\t}\n\tmove(dir){\n\t\t//Player is moving\n\t\tif (this.Moveable.step > 0) {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t//Change the direction of the player\n\t\tthis.Moveable.dir = dir;\n\n\t\t//Test whether the edge is in front of the player.\n\t\tvar nextPos = this.stage.getNeighbour(this.Moveable.col, this.Moveable.row, dir);\n\t\tif (undefined == nextPos) {\n\t\t\treturn false;\n\t\t}\n\n\t\t//Test the object in front of the player.\n\t\tvar nextPosObject = this.stage.getObject(nextPos.col, nextPos.row);\n\t\tif (nextPosObject != undefined){\n\t\t\tif (nextPosObject.pick == true){\n\t\t\t\tif (undefined != nextPosObject.onPick) {\n\t\t\t\t\tnextPosObject.onPick(this);\n\t\t\t\t}\n\t\t\t\tthis.stage.destroyObject(nextPos.col, nextPos.row);\n\t\t\t\tplayAudio('pick');\n\t\t\t} else if (nextPosObject.push == true) {\n\t\t\t\tlet nextPos2 = this.stage.getNeighbour(nextPos.col, nextPos.row, dir);\n\t\t\t\tif (undefined == nextPos2\n\t\t\t\t\t|| undefined != this.stage.getObject(nextPos2.col, nextPos2.row)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tthis.objectPushing = nextPosObject;\n\t\t\t\tthis.stage.setObject(nextPos2.col, nextPos2.row, new SpacerObject(nextPosObject));\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t//Finally move the player\n\t\tthis.Moveable.move(dir);\n\t\tthis.stage.setObject(this.Moveable.col, this.Moveable.row, new SpacerPlayer(this));\n\t\tthis.stage.getObject(this.Moveable.colPrev, this.Moveable.rowPrev).leaving = true;\n\t\treturn true;\n\t}\n\tonDrawMoving(ctx) {\n\t\tvar idx_img = [0, 1, 0, 2, 0, 1, 0, 2];\n\t\tvar __type = (this.girl ? this.type + 'Girl' : this.type);\n\t\tvar img = (this.invisible > 0 ? image[undefined]\n\t\t\t: image[__type][this.Moveable.dir][idx_img[this.Moveable.step]]);\n\t\tthis.Moveable.onDraw(img, ctx);\n\t\tif (this.Moveable.step % 2) {\n\t\t\tplayAudio('step');\n\t\t}\n\n\t\t//Draw the object player is pushing\n\t\tif (undefined != this.objectPushing) {\n\t\t\tvar _col, _row;\n\t\t\tswitch (this.Moveable.dir){\n\t\t\t\tcase DIR_NORTH:\n\t\t\t\t\t_col = this.Moveable.col;\n\t\t\t\t\t_row = this.Moveable.row - 1 + this.Moveable.step / this.Moveable.stepMax;\n\t\t\t\tbreak;\n\t\t\t\tcase DIR_EAST:\n\t\t\t\t\t_col = this.Moveable.col + 1 - this.Moveable.step / this.Moveable.stepMax;\n\t\t\t\t\t_row = this.Moveable.row;\n\t\t\t\tbreak;\n\t\t\t\tcase DIR_WEST:\n\t\t\t\t\t_col = this.Moveable.col - 1 + this.Moveable.step / this.Moveable.stepMax;\n\t\t\t\t\t_row = this.Moveable.row;\n\t\t\t\tbreak;\n\t\t\t\tcase DIR_SOUTH:\n\t\t\t\t\t_col = this.Moveable.col;\n\t\t\t\t\t_row = this.Moveable.row + 1 - this.Moveable.step / this.Moveable.stepMax;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.objectPushing.onDraw(ctx, _col, _row);\n\t\t}\n\t}\n\tonDrawSleepy(ctx) {\n\t\tif (this.invisible > 0) {\n\t\t\tthis.Moveable.onDraw(image[undefined], ctx);\n\t\t\treturn;\n\t\t}\n\n\t\tvar img;\n\t\tvar __type = (this.girl ? this.type + 'Girl' : this.type);\n\t\tif (this.sleepy < 50) {\n\t\t\tthis.onDrawMoving(ctx);\n\t\t\treturn;\n\t\t} else if (this.sleepy < 100) {\n\t\t\timg = image[__type]['sleepy'][0];\n\t\t} else if (this.sleepy < 300) {\n\t\t\timg = image[__type]['sleepy'][this.sleepy % 50 ? 0 : 1];\n\t\t} else if (this.sleepy < 400) {\n\t\t\timg = image[__type]['sleepy'][this.sleepy % 50 ? 2 : 3];\n\t\t} else {\n\t\t\timg = image[__type]['sleepy'][4];\n\t\t}\n\t\tthis.Moveable.onDraw(img, ctx);\n\t}\n\tonDraw(ctx) {\n\t\tif (this.Moveable.isMoving()) {\n\t\t\tthis.sleepy = 0;\n\t\t\tthis.onDrawMoving(ctx);\n\t\t} else {\n\t\t\tthis.sleepy++;\n\t\t\tthis.onDrawSleepy(ctx);\n\t\t}\n\t}\n}\n\n"],"names":["Maze","SPACE","undefined","WALL","FOOTPRINT","goal","footPrint","Array","constructor","w","h","initfunc","this","data","get","x","y","set","element","getDir","x0","y0","x1","y1","dx","dy","reachable","getPosByDir","dir","result","next","length","currentPos","dirCandidate","i","nextPos","push","pop","IMAGE_W","IMAGE_H","drawImage","__image","ctx","col","row","img","Math","floor","image","imageObj","Image","src","normal","ticking","detonate","N","E","W","S","sleepy","poisoned","digest","open","player","grab","grabApple","grabPlayer","DIR_NORTH","DIR_EAST","DIR_WEST","DIR_SOUTH","switchDir","sw","expr","L","R","B","TypeError","col0","row0","col1","row1","Moveable","stepMax","colPrev","rowPrev","step","isMoving","move","onTick","onDraw","audioContext","AudioContext","audioTable","bitten","crystal","lasershot","pick","playAudio","audioFile","document","querySelector","checked","source","createBufferSource","buffer","loop","connect","destination","start","getDirFromRoute","playerRoute","nextDir","splice","solved","stage","destCol","destRow","maze","cols","rows","object","getObject","blackArea","posList","resultRaw","mazeSolver","async","fileList","taskList","fileName","task","Promise","resolve","resp","fetch","ok","console","error","statusText","decodeAudioData","arrayBuffer","respAll","all","map","item","forEach","idx","loadSound","Object","keys","then","Level","score","speed","paused","dirKeyPressed","playerRouteInUse","addEventListener","keydownHandler","keyupHandler","mousedownHandler","setTimeout","timeoutFunc","onFinish","func","_onFinish","callOnFinish","removeEventListener","style","display","tick","draw","innerHTML","finished","reset","e","event","keyCode","xpos","offsetX","ypos","offsetY","shiftKey","SpacerDemon","type","destroy","leaving","onDestroy","demon","setObject","destroyDemon","SpacerLaser","timeout","SpacerObject","SpacerPFlower","typeGrabbed","SpacerPlayer","eat","onEat","destroyPlayer","SpacerPlayerPoisoned","destroyObject","__type","girl","leftFirst","DIR_LEFT","DIR_RIGHT","DIR_BACK","puzzlePackFinished","packName","totalScore","storageData","localStorage","getItem","JSON","parse","setItem","stringify","assign","window","Stage","name","posDestroyed","playerObj","indexOf","demonObj","getNeighbour","len","posDestoryed","Player","objectPushing","invisible","isGirl","objectPos","nextPosObject","onPick","nextPos2","onDrawMoving","_col","_row","onDrawSleepy","Demon","turning","initDir","dirArray","surrounded","pos","test","Apple","AppleRotten","timer","img_index","Ball","Bomb","detonated","doActivate","doDetonate","neighbour","ncol","nrow","moving","Crystal","triggered","TRIGGER","trigger","Door","Egg","poisonous","Flower","Key","LaserGun","detectedPos","blackAreaDetected","doDetect","__row","__col","setupLaser","posDetected","Mushroom","PFlower","spacerCol","spacerRow","opened","status","doOpen","doDigest","doGrab","detected","frameCount","frame","ceil","random","Pill","Treasure","Wall","rightFirst","randomSelection","randomTurn","irand","temp","levelData","getContext","levelNum","settingData","soundOn","target","blur","isNaN","Number","level","levelScore"],"mappings":"qOAAA,MAAMA,EACLC,WAAQC,EACRC,KAAO,EACPC,UAAY,EACZC,UAAOH,EACPI,UAAY,IAAIC,MAChBC,YAAYC,EAAGC,EAAGC,GACjBC,KAAKH,EAAIA,EACTG,KAAKF,EAAIA,EACTE,KAAKC,KAAO,IAAIN,MAAMK,KAAKH,EAAIG,KAAKF,GAGhCR,MAAaS,GAChBA,EAASC,MAGXE,IAAIC,EAAGC,GACN,OAAOJ,KAAKC,KAAKE,EAAIC,EAAIJ,KAAKH,GAE/BQ,IAAIF,EAAGC,EAAGE,UACFN,KAAKC,KAAKE,EAAIC,EAAIJ,KAAKH,GAC9BG,KAAKC,KAAKE,EAAIC,EAAIJ,KAAKH,GAAKS,EAE7BC,OAAOC,EAAIC,EAAIC,EAAIC,GACPX,KAAKP,KAChB,IAAImB,EAAKF,EAAKF,EACVK,EAAKF,EAAKF,EAEd,OAAU,GAANG,GAAiB,GAANC,EACP,GACGD,GAAM,GAAKC,EAAK,EACtBD,IAAOC,EACH,CAAC,IAAK,IAAK,IAAK,KAEhB,CAAC,IAAK,IAAK,IAAK,KAEdD,EAAK,GAAKC,EAAK,GACpBD,IAAOC,EACJ,CAAC,IAAK,IAAK,IAAK,KAEhB,CAAC,IAAK,IAAK,IAAK,KAEdD,EAAK,GAAKC,GAAM,GACrBD,GAAMC,EACH,CAAC,IAAK,IAAK,IAAK,KAEhB,CAAC,IAAK,IAAK,IAAK,KAEdD,GAAM,GAAKC,GAAM,EACvBD,GAAMC,EACF,CAAC,IAAK,IAAK,IAAK,KAEhB,CAAC,IAAK,IAAK,IAAK,UAJlB,EAQRC,UAAUX,EAAGC,GACZ,QAAID,EAAI,GAAKA,GAAKH,KAAKH,GAAKO,EAAI,GAAKA,GAAKJ,KAAKF,IAEpCE,KAAKX,OAASW,KAAKE,IAAIC,EAAGC,GAKtCW,YAAYZ,EAAGC,EAAGY,GACjB,IAAIC,EACJ,OAAQD,GACP,IAAK,IACJC,EAAS,CAACd,EAAEA,EAAGC,EAAEA,EAAE,GACpB,MACA,IAAK,IACJa,EAAS,CAACd,EAAEA,EAAE,EAAGC,EAAEA,GACpB,MACA,IAAK,IACJa,EAAS,CAACd,EAAEA,EAAE,EAAGC,EAAEA,GACpB,MACA,IAAK,IACJa,EAAS,CAACd,EAAEA,EAAGC,EAAEA,EAAE,GAGrB,OAAOa,EAERC,OACC,GAAI,GAAKlB,KAAKN,UAAUyB,OACvB,OAAO,EAER,IAAIC,EAAapB,KAAKN,UAAUM,KAAKN,UAAUyB,OAAS,GACxD,GAAIC,EAAWjB,GAAKH,KAAKP,KAAKU,GAAKiB,EAAWhB,GAAKJ,KAAKP,KAAKW,EAC5D,OAAO,EAGR,IAAIiB,EAAerB,KAAKO,OAAOa,EAAWjB,EAAGiB,EAAWhB,EAAGJ,KAAKP,KAAKU,EAAGH,KAAKP,KAAKW,GAClF,IAAK,IAAIkB,KAAKD,EAAc,CAC3B,IAAIE,EAAUvB,KAAKe,YAAYK,EAAWjB,EAAGiB,EAAWhB,EAAGiB,EAAaC,IACxE,GAAItB,KAAKc,UAAUS,EAAQpB,EAAGoB,EAAQnB,GAGrC,OAFAJ,KAAKN,UAAU8B,KAAKD,GACpBvB,KAAKK,IAAIkB,EAAQpB,EAAGoB,EAAQnB,EAAGJ,KAAKR,YAC7B,EAMT,OADeQ,KAAKN,UAAU+B,OACvB,GCvGF,MAAMC,EAAU,GACVC,EAAU,GAChB,SAASC,EAAUC,EAASC,EAAKC,EAAKC,GAC5CF,EAAIF,UAAUC,EAAQI,IACpBJ,EAAQ1B,EAAIuB,EAAWG,EAAQzB,EAAIuB,EAAUD,EAASC,EACvDO,KAAKC,MAAMJ,EAAML,GAAUQ,KAAKC,MAAMH,EAAML,GAAUD,EAASC,GAGjE,IAWWS,EAXPC,EAAW,IAAI1C,MACnB0C,EAAS,GAAK,IAAIC,MAClBD,EAAS,GAAGE,IAAM,cAClBF,EAAS,GAAK,IAAIC,MAClBD,EAAS,GAAGE,IAAM,cAClBF,EAAS,GAAK,IAAIC,MAClBD,EAAS,GAAGE,IAAM,cAClBF,EAAS,GAAK,IAAIC,MAClBD,EAAS,GAAGE,IAAM,eAElBH,EAAQ,IAAIzC,YAENL,GAAa,CAAC2C,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAC5CgC,EAAa,MAAI,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GAC1CgC,EAAmB,YAAI,CACtB,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1BgC,EAAY,KAAI,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzCgC,EAAY,KAAI,CACfI,OAAQ,CAACP,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACjCqC,QAAS,CACR,CAACR,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1BsC,SAAU,CAACT,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAEpCgC,EAAe,QAAI,CAClB,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1BgC,EAAa,MAAI,CAChBO,EAAI,CACH,CAACV,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1BwC,EAAI,CACH,CAACX,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1ByC,EAAI,CACH,CAACZ,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAE1B0C,EAAI,CACH,CAACb,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAG3BgC,EAAiB,UAAI,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAC9CgC,EAAY,KAAI,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzCgC,EAAW,IAAI,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACxCgC,EAAc,OAAI,CACjB,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1BgC,EAAW,IAAI,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACxCgC,EAAgB,SAAI,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GAC7CgC,EAAgB,SAAI,CACnB,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAE1BgC,EAAc,OAAI,CACjBO,EAAI,CACH,CAACV,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAE1BwC,EAAI,CACH,CAACX,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1ByC,EAAI,CACH,CAACZ,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAE1B0C,EAAI,CACH,CAACb,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1B2C,OAAS,CACR,CAACd,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1B4C,SAAY,CACX,CAACf,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAG3BgC,EAAkB,WAAI,CACrBO,EAAI,CACH,CAACV,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAE1BwC,EAAI,CACH,CAACX,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1ByC,EAAI,CACH,CAACZ,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAE1B0C,EAAI,CACH,CAACb,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1B2C,OAAS,CACR,CAACd,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1B4C,SAAY,CACX,CAACf,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAG3BgC,EAAe,QAAI,CAClBa,OAAQ,CACP,CAAChB,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1B8C,KAAM,CACL,CAACjB,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1B+C,OAAQ,CACP,CAAClB,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAE1BgD,KAAM,CACLT,EAAK,CAACV,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GAC9BwC,EAAK,CAACX,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GAC9ByC,EAAK,CAACZ,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GAC9B0C,EAAK,CAACb,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAGhCgC,EAAY,KAAI,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IACzCgC,EAAmB,YAAI,CACtB,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE1BgC,EAAqB,cAAI,CACxBiB,UAAW,CACVV,EAAK,CAACV,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GAC9BwC,EAAK,CAACX,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GAC9ByC,EAAK,CAACZ,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GAC9B0C,EAAK,CAACb,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAE/BkD,WAAY,CACXX,EAAK,CAACV,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GAC9BwC,EAAK,CAACX,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GAC9ByC,EAAK,CAACZ,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GAC9B0C,EAAK,CAACb,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,KAGhCgC,EAAgB,SAAI,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IAC7CgC,EAAY,KAAI,CACf,CAACH,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,GACzB,CAAC6B,IAAII,EAAS,GAAIlC,EAAE,EAAGC,EAAE,IC1NnB,MAAMmD,EAAU,IACVC,EAAS,IACTC,EAAS,IACTC,EAAU,IAMhB,SAASC,EAAU3C,EAAK4C,GAC9B,IAAIC,EACJ,OAAQ7C,GACP,KAAKuC,EACJM,EAAO,CAACC,EAAIL,EAAUM,EAAIP,EAAUQ,EAAIN,GACzC,MACA,KAAKF,EACJK,EAAO,CAACC,EAAIP,EAAWQ,EAAIL,EAAWM,EAAIP,GAC3C,MACA,KAAKA,EACJI,EAAO,CAACC,EAAIJ,EAAWK,EAAIR,EAAWS,EAAIR,GAC3C,MACA,KAAKE,EACJG,EAAO,CAACC,EAAIN,EAAUO,EAAIN,EAAUO,EAAIT,GACzC,MACA,QACC,MAAMU,UAGR,GAAI3E,MAAauE,EAAKD,GACrB,MAAMK,UAEP,OAAOJ,EAAKD,GAEN,SAASrD,EAAO2D,EAAMC,EAAMC,EAAMC,GACxC,GAAIF,GAAQE,GAAQH,GAAQE,EAG5B,OAAID,GAAQE,EACHH,EAAOE,EAAOZ,EAAWC,EACvBS,GAAQE,EACVD,EAAOE,EAAOX,EAAYH,OAElC,EAGK,MAAMe,EACZC,QAAU,EACVC,aAAUlF,EACVmF,aAAUnF,EACVoF,KAAO,EAEP9E,YAAYmC,EAAKC,EAAKhB,GACrBhB,KAAK+B,IAAMA,EACX/B,KAAKgC,IAAMA,EACXhC,KAAKgB,IAAMA,EAGZ2D,WACC,OAAI3E,KAAK0E,KAAO,EAMjBE,KAAK5D,GACJ,GAAIhB,KAAK2E,WACR,OAAO,EAOR,OAJA3E,KAAKgB,IAAMA,EACXhB,KAAK0E,KAAO1E,KAAKuE,QACjBvE,KAAKwE,QAAUxE,KAAK+B,IACpB/B,KAAKyE,QAAUzE,KAAKgC,IACbhB,GACN,KAAKuC,EACJvD,KAAKgC,MACN,MACA,KAAKwB,EACJxD,KAAK+B,MACN,MACA,KAAK0B,EACJzD,KAAK+B,MACN,MACA,KAAK2B,EACJ1D,KAAKgC,MAGP,OAAO,EAER6C,SACC,IAAI5D,OAAS3B,EAQb,OAPIU,KAAK2E,aACR3E,KAAK0E,OACA1E,KAAK2E,aACT1D,EAAS,CAACuD,QAASxE,KAAKwE,QAASC,QAASzE,KAAKyE,SAC/CzE,KAAKwE,QAAUxE,KAAKyE,aAAUnF,IAGzB2B,EAER6D,OAAO7C,EAAKH,GACX,OAAQ9B,KAAKgB,KACZ,KAAKuC,EACJ3B,EAAUK,EAAKH,EAAK9B,KAAK+B,IAAK/B,KAAKgC,IAAMhC,KAAK0E,KAAO1E,KAAKuE,SAC3D,MACA,KAAKf,EACJ5B,EAAUK,EAAKH,EAAK9B,KAAK+B,IAAM/B,KAAK0E,KAAO1E,KAAKuE,QAASvE,KAAKgC,KAC/D,MACA,KAAKyB,EACJ7B,EAAUK,EAAKH,EAAK9B,KAAK+B,IAAM/B,KAAK0E,KAAO1E,KAAKuE,QAASvE,KAAKgC,KAC/D,MACA,KAAK0B,EACJ9B,EAAUK,EAAKH,EAAK9B,KAAK+B,IAAK/B,KAAKgC,IAAMhC,KAAK0E,KAAO1E,KAAKuE,WAO9D,MAAMQ,EAAa,IAAIC,aAyBvB,IAAIC,EAAW,CACdC,OAAO,KACPC,QAAQ,KACRzC,SAAS,KACTU,KAAK,KACLgC,UAAU,KACVC,KAAK,KACLrC,SAAS,KACT0B,KAAK,MAKC,SAASY,EAAUC,GACzB,IAAIC,SAASC,cAAc,qBAAqBC,UAAYT,EAAWM,GACtE,OAED,IAAII,EAASZ,EAAaa,qBACvBD,EAAOE,OAASZ,EAAWM,GAC3BI,EAAOG,MAAO,EACdH,EAAOI,QAAQhB,EAAaiB,aAC/BL,EAAOM,QCnKR,SAASC,EAAgB/C,EAAQgD,GAIhC,IAHA,IAAIC,OAAU9G,EAGP6G,EAAYhF,OAAS,GACxBgC,EAAOmB,SAASvC,KAAOoE,EAAY,GAAGpE,KACtCoB,EAAOmB,SAAStC,KAAOmE,EAAY,GAAGnE,KACzCmE,EAAYE,OAAO,EAAG,GAIvB,GAAIF,EAAYhF,OAAS,EAAG,CAC3B,IAAIH,EAAMT,EAAO4C,EAAOmB,SAASvC,IAAKoB,EAAOmB,SAAStC,IACrDmE,EAAY,GAAGpE,IAAKoE,EAAY,GAAGnE,KACpC,GAAI1C,MAAa0B,EAChBoF,EAAUpF,MACJ,CACN,IAAIsF,EHqFQ,SAASC,EAAOpD,EAAQqD,EAASC,GA2B/C,IA1BA,IAAIxF,EAAS,IAAItB,MACb+G,EAAO,IAAItH,EAAKmH,EAAMI,KAAMJ,EAAMK,MAAM,SAASF,GACpD,IAAI3E,EAAKC,EACT,IAAKA,EAAM,EAAGA,EAAMuE,EAAMK,KAAM5E,IAC/B,IAAKD,EAAM,EAAGA,EAAMwE,EAAMI,KAAM5E,IAAO,CACtC,IAAI8E,EAASN,EAAMO,UAAU/E,EAAKC,GAClC,GAAI1C,MAAauH,EAKjB,GAAIvH,MAAauH,EAAOE,UAEvB,IADA,IAAIC,EAAUH,EAAOE,UAAUR,EAAOxE,EAAKC,GAClCV,EAAI,EAAGA,EAAI0F,EAAQ7F,OAAQG,IACnCoF,EAAKrG,IAAI2G,EAAQ1F,GAAGS,IAAKiF,EAAQ1F,GAAGU,IAAK0E,EAAKnH,WAErC,GAAQsH,EAAOxB,MACzBqB,EAAKrG,IAAI0B,EAAKC,EAAK0E,EAAKnH,MAI3BmH,EAAKjH,KAAO,CAACU,EAAEqG,EAASpG,EAAEqG,GAC1BC,EAAKhH,UAAY,CAAC,CAACS,EAAEgD,EAAOmB,SAASvC,IAAK3B,EAAE+C,EAAOmB,SAAStC,SAIvD0E,EAAKxF,SAGX,IAAI+F,EAAYP,EAAKhH,UACrB,GAAI,GAAKgH,EAAKhH,UAAUyB,OACvBF,OAAS3B,OAET,IAAK,IAAIgC,KAAKoF,EAAKhH,UAClBuB,EAAOO,KAAK,CAACO,IAAIkF,EAAU3F,GAAGnB,EAAG6B,IAAIiF,EAAU3F,GAAGlB,IAGpD,OAAOa,EG3HQiG,CAAW/D,EAAOoD,MAAOpD,EACrCgD,EAAY,GAAGpE,IAAKoE,EAAY,GAAGnE,KACpC,GAAI1C,MAAagH,EAAQ,CAExB,IAAK,IAAIhF,EADCgF,EAAOnF,OACE,EAAGG,GAAK,EAAGA,IAC7B6E,EAAYE,OAAO,EAAG,EAAGC,EAAOhF,IAEjCgF,EAAO,GACPF,EAAU7F,EAAO4C,EAAOmB,SAASvC,IAAKoB,EAAOmB,SAAStC,IAAKmE,EAAY,GAAGpE,IAAKoE,EAAY,GAAGnE,OAIjG,OAAOoE,GDyFRe,eAAyBC,GACxB,IAAIC,EAAS,GAAIpG,EAAO,GACxB,IAAI,IAAIqG,KAAYF,GACnB,SAAUE,GACTD,EAAS7F,KAAK,CACb8F,SAAAA,EACAC,KAAK,IAAIC,SAAQL,MAAMM,IACtB,IAAIC,QAAWC,MAAM,WAAWL,SAChC,IAAII,EAAKE,GAGR,OAFAC,QAAQC,MAAM,kBAAkBR,UAAiBI,EAAKK,mBACtDN,EAAQ,MAGT1C,EAAaiD,sBAAsBN,EAAKO,cAAcR,QAVzD,CAaGH,GAEJ,IAAIY,QAAcV,QAAQW,IAAId,EAASe,KAAIC,GAAMA,EAAKd,QAItD,OAHAF,EAASiB,SAAQ,CAACf,EAAKgB,KACtBtH,EAAOsG,EAAKD,UAAUY,EAAQK,IAAQ,QAEhCtH,GAYRuH,CAAUC,OAAOC,KAAKzD,IAAa0D,MAAM1I,IACxCgF,EAAWhF,KC1HG,MAAM2I,EACpBC,MAAQ,EACRC,MAAQ,IACRC,QAAS,EACTC,cAAgB,MAAC1J,OAAWA,GAC5B8G,QAAU,MAAC9G,OAAWA,GACtB6G,YAAc,CAAC,IAAIxG,MAAS,IAAIA,OAChCsJ,iBAAmB,EACnBrJ,YAAY2G,EAAOzE,GAClB9B,KAAKuG,MAAMA,EACXvG,KAAK8B,IAAIA,EACT0D,SAAS0D,iBAAiB,UAAUlJ,KAAKmJ,gBACzC3D,SAAS0D,iBAAiB,QAAQlJ,KAAKoJ,cACvC5D,SAASC,cAAc,gBAAgByD,iBAAiB,YAAYlJ,KAAKqJ,kBAEzEC,WAAWtJ,KAAKuJ,YAAavJ,KAAK8I,OAEnCU,SAASC,GACRzJ,KAAK0J,UAAUD,EAEhBE,aAAad,GACZrD,SAASoE,oBAAoB,UAAU5J,KAAKmJ,gBAC5C3D,SAASoE,oBAAoB,QAAQ5J,KAAKoJ,cAC1C5D,SAASC,cAAc,gBAAgBmE,oBAAoB,YAAY5J,KAAKqJ,kBACzErJ,KAAK0J,WACP1J,KAAK0J,UAAUb,GAGjBU,YAAY,KACX,IACC,GAAKvJ,KAAK+I,OAiCTvD,SAASC,cAAc,cAAcoE,MAAMC,QAAQ,SAjClC,CACjB,IAAI3G,EAASnD,KAAKuG,MAAMpD,OAGxB,IAAK,IAAI7B,KAAK6B,EACb,GAAKA,EAAO7B,KAAM6B,EAAO7B,GAAGgD,SAASK,WAGrC,GAAIrF,MAAaU,KAAKgJ,cAAc1H,GACnC6B,EAAO7B,GAAGsD,KAAK5E,KAAKgJ,cAAc1H,IAClCtB,KAAKmG,YAAY7E,GAAG,QACd,GAAIhC,MAAaU,KAAKoG,QAAQ9E,GAChC6B,EAAO7B,GAAGgD,SAAStD,KAAOhB,KAAKoG,QAAQ9E,IAC1C6B,EAAO7B,GAAGsD,KAAK5E,KAAKoG,QAAQ9E,IAE7BtB,KAAKmG,YAAY7E,GAAG,GACpBtB,KAAKoG,QAAQ9E,QAAKhC,MACZ,CACN,IAAI0B,EAAMkF,EAAgB/C,EAAO7B,GAAItB,KAAKmG,YAAY7E,IAClDhC,MAAa0B,GAChBmC,EAAO7B,GAAGsD,KAAK5D,GAMlBhB,KAAKuG,MAAMwD,KAAK/J,KAAK8B,KACrB9B,KAAKuG,MAAMyD,KAAKhK,KAAK8B,KAGrB0D,SAASC,cAAc,cAAcoE,MAAMC,QAAQ,OACnDtE,SAASC,cAAc,cAAcwE,UAAUjK,KAAKuG,MAAMsC,MAMvD7I,KAAKuG,MAAM2D,UACdlK,KAAK6I,MAAQ7I,KAAKuG,MAAMsC,MACxB7I,KAAKuG,MAAM4D,QACXnK,KAAK2J,aAAa3J,KAAK6I,QAEvBS,WAAWtJ,KAAKuJ,YAAavJ,KAAK8I,OAEnC,MAAMsB,GACNvC,QAAQC,MAAMsC,GACdd,WAAWtJ,KAAKuJ,YAAavJ,KAAK8I,SAGpCK,eAAgBkB,IACf,IAAKrK,KAAK+I,OAAQ,CACjB,IAAI3C,EAAQpG,KAAKoG,QAAS4C,EAAchJ,KAAKgJ,cAC7C,OAAQqB,EAAMC,SACb,KAAK,GACJlE,EAAQ,GAAK4C,EAAc,GAAKvF,SACjC,MACA,KAAK,GACJ2C,EAAQ,GAAK4C,EAAc,GAAKzF,UACjC,MACA,KAAK,GACJ6C,EAAQ,GAAK4C,EAAc,GAAKxF,SACjC,MACA,KAAK,GACJ4C,EAAQ,GAAK4C,EAAc,GAAKtF,UACjC,MACA,KAAK,GACJ0C,EAAQ,GAAK4C,EAAc,GAAKvF,SACjC,MACA,KAAK,GACJ2C,EAAQ,GAAK4C,EAAc,GAAKzF,UACjC,MACA,KAAK,GACJ6C,EAAQ,GAAK4C,EAAc,GAAKxF,SACjC,MACA,KAAK,GACJ4C,EAAQ,GAAK4C,EAAc,GAAKtF,WAInC,OAAQ2G,EAAMC,SACb,KAAK,GACJtK,KAAKiJ,iBAAmB,EACzB,MACA,KAAK,GACJjJ,KAAKiJ,iBAAmB,EACzB,MACA,KAAK,GACJjJ,KAAK+I,QAAU/I,KAAK+I,OACrB,MACA,KAAK,GACJ,IAAK,IAAIzH,KAAKtB,KAAKoG,QAClBpG,KAAKoG,QAAQ9E,QAAKhC,EAEnB,IAAK,IAAIgC,KAAKtB,KAAKgJ,cAClBhJ,KAAKgJ,cAAc1H,QAAKhC,EAEzB,IAAK,IAAIgC,KAAKtB,KAAKmG,YAClBnG,KAAKmG,YAAY7E,GAAG,GAErBtB,KAAKuG,MAAM4D,QACXnK,KAAK+I,QAAS,EACf,MACA,KAAK,GACJ/I,KAAK8I,MAAQ,KAIhBM,aAAciB,IACb,IAAKrK,KAAK+I,OACT,OAAQsB,EAAMC,SACb,KAAK,GACL,KAAK,GACL,KAAK,GACL,KAAK,GACJtK,KAAKgJ,cAAc,QAAK1J,EACzB,MACA,KAAK,GACL,KAAK,GACL,KAAK,GACL,KAAK,GACJU,KAAKgJ,cAAc,QAAK1J,EAI3B,OAAQ+K,EAAMC,SACb,KAAK,GACJtK,KAAK8I,MAAQ,MAIhBO,iBAAkBe,IACjB,GAAIpK,KAAK+I,OACR,OAED,IAAIwB,EAAOH,EAAEI,QACTC,EAAOL,EAAEM,QACT3I,EAAMG,KAAKC,MAAMoI,EAAK7I,GACtBM,EAAME,KAAKC,MAAMsI,EAAK9I,GACtByI,EAAEO,SACL3K,KAAKmG,YAAYnG,KAAKiJ,kBAAkBzH,KAAK,CAACO,IAAIA,EAAKC,IAAIA,IAE3DhC,KAAKmG,YAAYnG,KAAKiJ,kBAAoB,CAAC,CAAClH,IAAIA,EAAKC,IAAIA,KC0XrD,MAAM4I,EACZC,KAAO,cACPC,SAAU,EACVC,SAAU,EACVnL,YAAY2C,GACXvC,KAAKuC,IAAMA,EAEZyI,UAAUzE,EAAOxE,EAAKC,GACrB,IAAKhC,KAAK+K,QAAS,CAClB,IAAIE,EAAQjL,KAAKuC,IACbjD,MAAa2L,EAAM3G,SAASE,SAC5BlF,MAAa2L,EAAM3G,SAASG,SAC/B8B,EAAM2E,UAAUD,EAAM3G,SAASE,QAASyG,EAAM3G,SAASG,aAASnF,GAEjEiH,EAAM4E,aAAaF,IAGrBpG,OAAO0B,EAAOxE,EAAKC,GACdhC,KAAK+K,UACR/K,KAAK8K,SAAU,IAaX,MAAMM,EACZP,KAAO,cACPQ,QAAU,EACVzL,YAAYoB,GACXhB,KAAKgB,IAAIA,EAEV6D,OAAO0B,EAAOxE,EAAKC,GAClBhC,KAAKqL,UACDrL,KAAKqL,SAAW,GACnB9E,EAAM2E,UAAUnJ,EAAKC,OAAK1C,GAG5BwF,OAAOhD,EAAKC,EAAKC,GAEhB,OAAOhC,KAAKgB,KACX,KAAKuC,UACL,KAAKG,UACJ9B,EAAUQ,EAAMpC,KAAK6K,MAAM,GAAI/I,EAAKC,EAAKC,GAC1C,MACA,KAAKwB,SACL,KAAKC,SACJ7B,EAAUQ,EAAMpC,KAAK6K,MAAM,GAAI/I,EAAKC,EAAKC,KAKtC,MAAMsJ,EACZT,KAAO,eACPjL,YAAY2C,GACXvC,KAAKuC,IAAMA,GAGN,MAAMgJ,EACZV,KAAO,gBACPQ,QAAU,GACVzL,YAAYoB,EAAK6J,GAChB7K,KAAKgB,IAAMA,EACXhB,KAAKwL,YAAcX,EAEpBhG,OAAO0B,EAAOxE,EAAKC,GAClBhC,KAAKqL,UACDrL,KAAKqL,SAAW,GACnB9E,EAAM2E,UAAUnJ,EAAKC,OAAK1C,GAG5BwF,OAAOhD,EAAKC,EAAKC,GAChB,IAAIC,EACJ,OAAQjC,KAAKwL,aACZ,IAAK,eACJvJ,EAAMG,EAAMpC,KAAK6K,MAAkB,WAAE7K,KAAKgB,KAC3C,MACA,IAAK,QACL,IAAK,cACJiB,EAAMG,EAAMpC,KAAK6K,MAAiB,UAAE7K,KAAKgB,KAG3CY,EAAUK,EAAKH,EAAKC,EAAKC,IAGpB,MAAMyJ,EACZZ,KAAO,eACPa,KAAM,EACNZ,SAAU,EACVC,SAAU,EACVnL,YAAY2C,GACXvC,KAAKuC,IAAMA,EAEZoJ,MAAMV,EAAO1E,EAAOxE,EAAKC,GACnBhC,KAAK+K,UACL/K,KAAKuC,IAAIS,UACZsC,EAAU,UAEXtF,KAAKuC,IAAIS,UAAW,GAGtBgI,UAAUzE,EAAOxE,EAAKC,GACrB,IAAImB,EAASnD,KAAKuC,IACdjD,MAAa6D,EAAOmB,SAASE,SAC7BlF,MAAa6D,EAAOmB,SAASG,SAChC8B,EAAM2E,UAAU/H,EAAOmB,SAASE,QAASrB,EAAOmB,SAASG,aAASnF,GAEnEiH,EAAMqF,cAAczI,GAErB0B,OAAO0B,EAAOxE,EAAKC,GACdhC,KAAK+K,QACR/K,KAAK8K,QAAU9K,KAAK0L,KAAM,EAE1B1L,KAAK8K,QAAU9K,KAAK0L,KAAM,GAItB,MAAMG,EACZhB,KAAO,uBACPQ,QAAU,GACVzL,YAAYuD,GACXnD,KAAKmD,OAAOA,EACZnD,KAAKgB,IAAMmC,EAAOmB,SAAStD,IAE5B6D,OAAO0B,EAAOxE,EAAKC,GACd,GAAKhC,KAAKqL,QAIdrL,KAAKqL,UAHJ9E,EAAMuF,cAAc/J,EAAKC,GAK3B8C,OAAOhD,EAAKC,EAAKC,GAChB,IAAI+J,EAAU/L,KAAKmD,OAAO6I,KAAO,aAAe,SAC5ChM,KAAKqL,QAAU,GAClBzJ,EAAUQ,EAAM2J,GAAQ/L,KAAKgB,KAAK,GAAIc,EAAKC,EAAKC,GAEhDJ,EAAUQ,EAAM2J,GAAkB,SAAE/L,KAAKqL,QAAU,GAAK,GAAKrL,KAAKqL,SAAUvJ,EAAKC,EAAKC,GAGnF,IAAMhC,KAAKqL,SACd/F,EAAU,aCttBN,SAAS2G,EAAUhB,GACzB,IAAIjK,EAAMiK,EAAM3G,SAAStD,IACzB,MAAO,CACNA,EACA2C,EAAU3C,EAAKkL,UACfvI,EAAU3C,EAAKmL,WACfxI,EAAU3C,EAAKoL,WCmEjB,SAASC,EAAmBC,EAAUC,GACrC/G,SAASC,cAAc,gBAAgBoE,MAAMC,QAAQ,OACrDtE,SAASC,cAAc,cAAcoE,MAAMC,QAAQ,OACnDtE,SAASC,cAAc,oBAAoBoE,MAAMC,QAAQ,QACzDtE,SAASC,cAAc,kCAAkCwE,UAAUsC,EAEnE,IACC,IAAIC,EAAYC,aAAaC,QAAQ,iBAClCF,IACFA,EAAYG,KAAKC,MAAMJ,UAChBA,EAAYF,EAAW,iBACvBE,EAAYF,EAAW,UAC9BG,aAAaI,QAAQ,gBAAgBF,KAAKG,UAAUN,KAErD,MAAMpC,GACNvC,QAAQC,MAAMsC,WAjDhB3B,OAAOsE,OAAOC,OAAO,CACpBC,MC3Cc,MACdC,KAAO,GACPvG,KAAO,GACPC,KAAO,GAEP3G,KAAO,IAAIN,MAAM,KACjBwD,OAAS,IAAIxD,MACbsL,MAAQ,IAAItL,MAEZwN,aAAe,IAAIxN,MACnBuK,UAAW,EACXrB,MAAQ,EAERjJ,YAAYG,GAEPT,MAAaS,IAChBC,KAAKD,SAASA,EACdA,EAASC,OAIX8G,UAAU/E,EAAKC,GACd,OAAOhC,KAAKC,KAAK+B,EAAMhC,KAAK2G,KAAO5E,GAEpCmJ,UAAUnJ,EAAKC,EAAK6E,UACZ7G,KAAKC,KAAK+B,EAAMhC,KAAK2G,KAAO5E,GACnC/B,KAAKC,KAAK+B,EAAMhC,KAAK2G,KAAO5E,GAAO8E,EAEpCiF,cAAc/J,EAAKC,GAClB,IAAI6E,EAAS7G,KAAK8G,UAAU/E,EAAKC,GAC7B1C,MAAauH,IACZvH,MAAauH,EAAOmE,WACvBnE,EAAOmE,UAAUhL,KAAM+B,EAAKC,GAE7BhC,KAAKmN,aAAa3L,KAAK,CAACO,EAAKC,IAC7BhC,KAAKkL,UAAUnJ,EAAKC,OAAK1C,IAG3BsM,cAAcwB,GACbpN,KAAKmD,OAAOnD,KAAKmD,OAAOkK,QAAQD,IAAc,KAC9CpN,KAAKmD,OAAOnD,KAAKmD,OAAOkK,QAAQD,SAAc9N,EAC9C8N,EAAY,KAEbjC,aAAamC,GACZtN,KAAKiL,MAAMjL,KAAKiL,MAAMoC,QAAQC,IAAa,KAC3CtN,KAAKiL,MAAMjL,KAAKiL,MAAMoC,QAAQC,SAAahO,EAC3CgO,EAAW,KAGZC,aAAaxL,EAAKC,EAAKhB,GACtB,OAAQA,GACP,KAAKuC,UACJ,OAAIvB,EAAM,EACF,CAACD,IAAIA,EAAKC,IAAKA,EAAM,QAE5B,EAGF,KAAKwB,SACJ,OAAIzB,EAAO/B,KAAK2G,KAAO,EACf,CAAC5E,IAAKA,EAAM,EAAIC,IAAIA,QAE3B,EAGF,KAAKyB,SACJ,OAAI1B,EAAM,EACF,CAACA,IAAKA,EAAM,EAAIC,IAAIA,QAE3B,EAGF,KAAK0B,UACJ,OAAI1B,EAAOhC,KAAK4G,KAAO,EACf,CAAC7E,IAAIA,EAAKC,IAAKA,EAAM,QAE5B,EAGF,QACC,IAAIf,EAAS,IAAItB,MAkBjB,OAhBIqC,EAAM,GACTf,EAAOO,KAAK,CAACO,IAAIA,EAAKC,IAAKA,EAAM,EAAIhB,IAAIuC,YAGtCxB,EAAO/B,KAAK2G,KAAO,GACtB1F,EAAOO,KAAK,CAACO,IAAKA,EAAM,EAAIC,IAAIA,EAAKhB,IAAIwC,WAGtCzB,EAAM,GACTd,EAAOO,KAAK,CAACO,IAAKA,EAAM,EAAIC,IAAIA,EAAKhB,IAAIyC,WAGtCzB,EAAOhC,KAAK4G,KAAO,GACtB3F,EAAOO,KAAK,CAACO,IAAIA,EAAKC,IAAKA,EAAM,EAAIhB,IAAI0C,YAGnCzC,GAKV8I,KAAKjI,GAGJ,IADA,IAAI0L,EAAMxN,KAAKmD,OAAOhC,OACbG,EAAI,EAAGA,EAAIkM,EAAKlM,IACpBhC,MAAaU,KAAKmD,OAAO7B,IAC5BtB,KAAKmD,OAAO7B,GAAGuD,OAAO7E,MAMxB,IADIwN,EAAMxN,KAAKiL,MAAM9J,OACZG,EAAI,EAAGA,EAAIkM,EAAKlM,IACpBhC,MAAaU,KAAKiL,MAAM3J,IAC3BtB,KAAKiL,MAAM3J,GAAGuD,OAAO7E,MAKvB,IAAK,IAAIgC,EAAM,EAAGA,EAAMhC,KAAK4G,KAAM5E,IAClC,IAAK,IAAID,EAAM,EAAGA,EAAM/B,KAAK2G,KAAM5E,IAAO,CACzC,IAAI8E,EAAS7G,KAAKC,KAAK+B,EAAMhC,KAAK2G,KAAO5E,GACrCzC,MAAauH,GAAUvH,MAAauH,EAAOhC,QAC9CgC,EAAOhC,OAAO7E,KAAM+B,EAAKC,IAK7BgI,KAAKlI,GAEJ,IAAK,IAAIE,EAAM,EAAGA,EAAMhC,KAAK4G,KAAM5E,IAClC,IAAK,IAAID,EAAM,EAAGA,EAAM/B,KAAK2G,KAAM5E,IAAO,CACzC,IAAI8E,EAAS7G,KAAKC,KAAK+B,EAAMhC,KAAK2G,KAAO5E,GACrCzC,MAAauH,GAAUvH,MAAauH,EAAO/B,OAC9ClD,EAAUQ,OAAM9C,GAAYwC,EAAKC,EAAKC,GAEtC6E,EAAO/B,OAAOhD,EAAKC,EAAKC,GAO3B,IADA,IAAIwL,EAAMxN,KAAKmN,aAAahM,OACnBG,EAAI,EAAGA,EAAIkM,EAAKlM,IACxBS,EAAM/B,KAAKmN,aAAa7L,GAAG,GAC3BU,EAAMhC,KAAKmN,aAAa7L,GAAG,GAC3BM,EAAUQ,EAAiB,UAAGN,EAAKC,EAAKC,UAElChC,KAAKyN,aACZzN,KAAKmN,aAAe,GAIpB,IADIK,EAAMxN,KAAKiL,MAAM9J,OACZG,EAAI,EAAGA,EAAIkM,EAAKlM,IACpBhC,MAAaU,KAAKiL,MAAM3J,IAC3BtB,KAAKiL,MAAM3J,GAAGwD,OAAOhD,GAIvB,IADI0L,EAAMxN,KAAKmD,OAAOhC,OACbG,EAAI,EAAGA,EAAIkM,EAAKlM,IACpBhC,MAAaU,KAAKmD,OAAO7B,IAC5BtB,KAAKmD,OAAO7B,GAAGwD,OAAOhD,GAIzBqI,eACQnK,KAAKC,YACLD,KAAKmD,cACLnD,KAAKiL,aACLjL,KAAKyN,aACZzN,KAAKC,KAAO,IAAIN,MAAMK,KAAK4G,KAAO5G,KAAK2G,MACvC3G,KAAKmD,OAAS,IAAIxD,MAClBK,KAAKiL,MAAQ,IAAItL,MACjBK,KAAKmN,aAAe,IAAIxN,MACxBK,KAAKkK,UAAW,EAChBlK,KAAK6I,MAAQ,EACTvJ,MAAaU,KAAKD,UACrBC,KAAKD,SAASC,QDvIhB0N,OEzCc,MACd7C,KAAO,SACPX,UAAW,EACXlH,UAAW,EACX2K,mBAAgBrO,EAChBsO,UAAY,EACZ7K,OAAS,EACTnD,YAAY2G,EAAOxE,EAAKC,EAAK6L,GAC5B7N,KAAKsE,SAAW,IAAIA,EAASvC,EAAKC,EAAK0B,WACvC1D,KAAKgM,KAAO6B,EACZ7N,KAAKuG,MAAQA,EACbvG,KAAKuG,MAAM2E,UAAUnJ,EAAKC,EAAK,IAAIyJ,EAAazL,OAEjD6E,OAAO0B,GACN,IAAItF,EAASjB,KAAKsE,SAASO,SAC3B,GAAIvF,MAAa2B,IAChBjB,KAAKuG,MAAM2E,UAAUjK,EAAOuD,QAASvD,EAAOwD,aAASnF,GACjDA,MAAaU,KAAK2N,eAAe,CACpC,IAAIG,EAAY9N,KAAKuG,MAAMgH,aAC1BvN,KAAKsE,SAASvC,IAAK/B,KAAKsE,SAAStC,IAAKhC,KAAKsE,SAAStD,KACrDhB,KAAKuG,MAAM2E,UAAU4C,EAAU/L,IAAK+L,EAAU9L,IAAMhC,KAAK2N,eACzD3N,KAAK2N,mBAAgBrO,EAGvB,GAAIA,MAAa2B,IAAWjB,KAAKsE,SAASK,WAAY,CAErD,GAAqB,GAAjB3E,KAAKgD,SAIR,OAHAhD,KAAKuG,MAAM2E,UAAUlL,KAAKsE,SAASvC,IAAK/B,KAAKsE,SAAStC,IACrD,IAAI6J,EAAqB7L,YAC1BA,KAAKuG,MAAMqF,cAAc5L,MAKtBA,KAAKkK,WACRlK,KAAKuG,MAAM2D,UAAW,GAIpB5K,MAAaU,KAAK2N,eAClBrO,MAAaU,KAAK2N,cAAc9I,QACnC7E,KAAK2N,cAAc9I,OAAO7E,KAAKuG,OAAQ,GAAI,GAIxCvG,KAAK4N,UAAY,GACpB5N,KAAK4N,YAGPhJ,KAAK5D,GAEJ,GAAIhB,KAAKsE,SAASI,KAAO,EACxB,OAAO,EAIR1E,KAAKsE,SAAStD,IAAMA,EAGpB,IAAIO,EAAUvB,KAAKuG,MAAMgH,aAAavN,KAAKsE,SAASvC,IAAK/B,KAAKsE,SAAStC,IAAKhB,GAC5E,GAAI1B,MAAaiC,EAChB,OAAO,EAIR,IAAIwM,EAAgB/N,KAAKuG,MAAMO,UAAUvF,EAAQQ,IAAKR,EAAQS,KAC9D,GAAqB1C,MAAjByO,EACH,GAA0B,GAAtBA,EAAc1I,KACb/F,MAAayO,EAAcC,QAC9BD,EAAcC,OAAOhO,MAEtBA,KAAKuG,MAAMuF,cAAcvK,EAAQQ,IAAKR,EAAQS,KAC9CsD,EAAU,YACJ,CAAA,GAA0B,GAAtByI,EAAcvM,KASxB,OAAO,EAT+B,CACtC,IAAIyM,EAAWjO,KAAKuG,MAAMgH,aAAahM,EAAQQ,IAAKR,EAAQS,IAAKhB,GACjE,GAAI1B,MAAa2O,GACb3O,MAAaU,KAAKuG,MAAMO,UAAUmH,EAASlM,IAAKkM,EAASjM,KAC5D,OAAO,EAERhC,KAAK2N,cAAgBI,EACrB/N,KAAKuG,MAAM2E,UAAU+C,EAASlM,IAAKkM,EAASjM,IAAK,IAAIsJ,EAAayC,KAUpE,OAHA/N,KAAKsE,SAASM,KAAK5D,GACnBhB,KAAKuG,MAAM2E,UAAUlL,KAAKsE,SAASvC,IAAK/B,KAAKsE,SAAStC,IAAK,IAAIyJ,EAAazL,OAC5EA,KAAKuG,MAAMO,UAAU9G,KAAKsE,SAASE,QAASxE,KAAKsE,SAASG,SAASsG,SAAU,GACtE,EAERmD,aAAapM,GACZ,IACIiK,EAAU/L,KAAKgM,KAAOhM,KAAK6K,KAAO,OAAS7K,KAAK6K,KAChD5I,EAAOjC,KAAK4N,UAAY,EAAIxL,OAAM9C,GACnC8C,EAAM2J,GAAQ/L,KAAKsE,SAAStD,KAHjB,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAGQhB,KAAKsE,SAASI,OAO1D,GANA1E,KAAKsE,SAASQ,OAAO7C,EAAKH,GACtB9B,KAAKsE,SAASI,KAAO,GACxBY,EAAU,QAIPhG,MAAaU,KAAK2N,cAAe,CACpC,IAAIQ,EAAMC,EACV,OAAQpO,KAAKsE,SAAStD,KACrB,KAAKuC,UACJ4K,EAAOnO,KAAKsE,SAASvC,IACrBqM,EAAOpO,KAAKsE,SAAStC,IAAM,EAAIhC,KAAKsE,SAASI,KAAO1E,KAAKsE,SAASC,QACnE,MACA,KAAKf,SACJ2K,EAAOnO,KAAKsE,SAASvC,IAAM,EAAI/B,KAAKsE,SAASI,KAAO1E,KAAKsE,SAASC,QAClE6J,EAAOpO,KAAKsE,SAAStC,IACtB,MACA,KAAKyB,SACJ0K,EAAOnO,KAAKsE,SAASvC,IAAM,EAAI/B,KAAKsE,SAASI,KAAO1E,KAAKsE,SAASC,QAClE6J,EAAOpO,KAAKsE,SAAStC,IACtB,MACA,KAAK0B,UACJyK,EAAOnO,KAAKsE,SAASvC,IACrBqM,EAAOpO,KAAKsE,SAAStC,IAAM,EAAIhC,KAAKsE,SAASI,KAAO1E,KAAKsE,SAASC,QAGpEvE,KAAK2N,cAAc7I,OAAOhD,EAAKqM,EAAMC,IAGvCC,aAAavM,GACZ,GAAI9B,KAAK4N,UAAY,EACpB5N,KAAKsE,SAASQ,OAAO1C,OAAM9C,GAAYwC,OADxC,CAKA,IAAIG,EACA8J,EAAU/L,KAAKgM,KAAOhM,KAAK6K,KAAO,OAAS7K,KAAK6K,KAChD7K,KAAK+C,OAAS,GACjB/C,KAAKkO,aAAapM,IAGlBG,EADUjC,KAAK+C,OAAS,IAClBX,EAAM2J,GAAgB,OAAE,GACpB/L,KAAK+C,OAAS,IAClBX,EAAM2J,GAAgB,OAAE/L,KAAK+C,OAAS,GAAK,EAAI,GAC3C/C,KAAK+C,OAAS,IAClBX,EAAM2J,GAAgB,OAAE/L,KAAK+C,OAAS,GAAK,EAAI,GAE/CX,EAAM2J,GAAgB,OAAE,GAE/B/L,KAAKsE,SAASQ,OAAO7C,EAAKH,KAE3BgD,OAAOhD,GACF9B,KAAKsE,SAASK,YACjB3E,KAAK+C,OAAS,EACd/C,KAAKkO,aAAapM,KAElB9B,KAAK+C,SACL/C,KAAKqO,aAAavM,MFhHpBwM,MDIc,MACdzD,KAAO,QACP0D,QAAUtC,EACVrM,YAAY2G,EAAOxE,EAAKC,EAAKwM,GAC5BxO,KAAKsE,SAAW,IAAIA,EAASvC,EAAKC,EAAKwM,GACvCxO,KAAKuG,MAAQA,EACbvG,KAAKuG,MAAM2E,UAAUnJ,EAAKC,EAAK,IAAI4I,EAAY5K,OAC/CA,KAAKgB,IAAMwN,EAEZ5J,KAAK5D,GAEJ,QAAIhB,KAAKsE,SAASI,KAAO,KAKzB1E,KAAKsE,SAAStD,IAAMA,EAGpBhB,KAAKsE,SAASM,KAAK5D,GACnBhB,KAAKuG,MAAM2E,UAAUlL,KAAKsE,SAASvC,IAAK/B,KAAKsE,SAAStC,IAAK,IAAI4I,EAAY5K,OAC3EA,KAAKuG,MAAMO,UAAU9G,KAAKsE,SAASE,QAASxE,KAAKsE,SAASG,SAASsG,SAAU,GACtE,GAERlG,OAAO0B,GACN,GAAIvG,KAAKsE,SAASK,WAAW,CAC5B,IAAI1D,EAASjB,KAAKsE,SAASO,SAK3B,OAJA7E,KAAKgB,IAAMhB,KAAKsE,SAAStD,SACrB1B,MAAa2B,GAChBjB,KAAKuG,MAAM2E,UAAUjK,EAAOuD,QAASvD,EAAOwD,aAASnF,IAIvD,IAAImP,EAAWzO,KAAKuO,QAAQvO,MAAO0O,GAAW,EAG9C,IAAI,IAAI1N,KAAOyN,EAAS,CACvB,IAAIE,EAAMpI,EAAMgH,aAAavN,KAAKsE,SAASvC,IAAK/B,KAAKsE,SAAStC,IAAKhB,GAC/D1B,MAAaqP,IAGJpI,EAAMO,UAAU6H,EAAI5M,IAAK4M,EAAI3M,OAEzC0M,GAAW,IAGb,GAAGA,EAAH,CAEC,IAAIC,EAAMpI,EAAMgH,aAAavN,KAAKsE,SAASvC,IAAK/B,KAAKsE,SAAStC,IAAKhC,KAAKgB,KACxE,IAAI2N,EACH,OAED,IAAI9H,EAASN,EAAMO,UAAU6H,EAAI5M,IAAK4M,EAAI3M,KACvC6E,IAAW,WAAW+H,KAAK/H,EAAOgE,OAAShE,EAAO6E,MAEpD7E,EAAO8E,OAAS9E,EAAO8E,MAAM3L,KAAMuG,EAAOoI,EAAI5M,IAAK4M,EAAI3M,KAEvDuE,EAAMuF,cAAc6C,EAAI5M,IAAK4M,EAAI3M,KAC7BhC,KAAK4E,KAAK5E,KAAKgB,MAClBhB,KAAKsE,SAASI,aAMjB,IAAK,IAAIpD,KAAKmN,EAAU,CACvBzO,KAAKgB,IAAMyN,EAASnN,GACpB,IAAIqN,EAAMpI,EAAMgH,aAAavN,KAAKsE,SAASvC,IAAK/B,KAAKsE,SAAStC,IAAKyM,EAASnN,IAE5E,GAAIhC,MAAaqP,EAAjB,CAIA,IAAI9H,EAASN,EAAMO,UAAU6H,EAAI5M,IAAK4M,EAAI3M,KAC1C,GAAI1C,MAAauH,EAAQ,CAExB,GAAI,WAAW+H,KAAK/H,EAAOgE,QAEtB,GAAQhE,EAAO6E,KAAOpM,MAAauH,EAAO8E,OAC7C9E,EAAO8E,MAAM3L,KAAMuG,EAAOoI,EAAI5M,IAAK4M,EAAI3M,KAErB,eAAf6E,EAAOgE,MACV,MAKF,GAAI,GAAQhE,EAAO6E,IAClB,SAIGpM,MAAauH,EAAO8E,OACvB9E,EAAO8E,MAAM3L,KAAMuG,EAAOoI,EAAI5M,IAAK4M,EAAI3M,KAGxCuE,EAAMuF,cAAc6C,EAAI5M,IAAK4M,EAAI3M,KAElC,GAAIhC,KAAK4E,KAAK6J,EAASnN,IAAK,CAC3BtB,KAAKsE,SAASI,OACd,SAIHI,OAAOhD,GACN,IACIG,EAAMG,EAAMpC,KAAK6K,MAAM7K,KAAKgB,KADlB,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GACMhB,KAAKsE,SAASI,OAC3D1E,KAAKsE,SAASQ,OAAO7C,EAAKH,KC9G3B+M,MF5CM,MACNhE,KAAK,QACLrJ,MAAK,EACLkK,KAAI,EACJZ,SAAQ,EACRjG,OAAO0B,EAAOxE,EAAKC,GACdhC,KAAK+K,UACR/K,KAAK8K,SAAU,GAGjBhG,OAAOhD,EAAKC,EAAKC,GAChBJ,EAAUQ,EAAMpC,KAAK6K,MAAO/I,EAAKC,EAAKC,KEkCvC8M,YF/BM,MACNjE,KAAK,cACLrJ,MAAK,EACLkK,KAAI,EACJZ,SAAQ,EACRiE,MAAQ,EACRC,UAAY,EACZlK,OAAOhD,EAAKC,EAAKC,GAChBhC,KAAK+O,QACD,GAAM/O,KAAK+O,MAAQ,IACtB/O,KAAKgP,UAAa,GAAKhP,KAAKgP,UAAY,EAAI,GAE7CpN,EAAUQ,EAAMpC,KAAK6K,MAAM7K,KAAKgP,WAAYlN,EAAKC,EAAKC,KEoBvDiN,KFjBM,MACNpE,KAAK,OACLrJ,MAAO,EACPsD,OAAOhD,EAAKC,EAAKC,GAChBJ,EAAUQ,EAAMpC,KAAK6K,MAAO/I,EAAKC,EAAKC,KEcvCkN,KFXM,MACNrE,KAAO,OACPrJ,MAAO,EACP6J,SAAW,EACX8D,WAAY,EACZC,aACKpP,KAAKqL,QAAU,IAClBrL,KAAKqL,QAAU,KAGjBgE,WAAW9I,EAAOxE,EAAKC,GACtBhC,KAAKwB,UAAOlC,EACZU,KAAKmP,WAAY,EAGjB,IAFA,IAAIG,EAAY/I,EAAMgH,aAAaxL,EAAKC,GACpCwL,EAAM8B,EAAUnO,OACXG,EAAI,EAAGA,EAAIkM,EAAKlM,IAAK,CAC7B,IAAIiO,EAAOD,EAAUhO,GAAGS,IACpByN,EAAOF,EAAUhO,GAAGU,IACpB6E,EAASN,EAAMO,UAAUyI,EAAMC,GAC/BlQ,MAAauH,IACZA,EAAOiE,QACVvE,EAAMuF,cAAcyD,EAAMC,GAChB3I,EAAOgE,MAAQ7K,KAAK6K,MAC9BhE,EAAOuI,cAIVE,EAAUjJ,OAAO,EAAGiJ,EAAUnO,QAG9BmE,EAAU,YAEXT,OAAO0B,EAAOxE,EAAKC,GAClB,IAAIyN,GAAS,GACT1N,EAAM,GAAKC,EAAM,KACpByN,GAAS,GAGNA,GAAUzP,KAAKqL,QAAU,EAC5BrL,KAAKoP,aACKpP,KAAKqL,QAAU,GACzBrL,KAAKqL,UAGF,GAAKrL,KAAKqL,UACTrL,KAAKmP,UACR5I,EAAM2E,UAAUnJ,EAAKC,OAAK1C,GACfmQ,GACXzP,KAAKqP,WAAW9I,EAAOxE,EAAKC,IAI/B8C,OAAOhD,EAAKC,EAAKC,GACZhC,KAAKqL,QAAU,EAClBzJ,EAAUQ,EAAMpC,KAAK6K,MAAc,OAAG/I,EAAKC,EAAKC,GACtChC,KAAKmP,UACfvN,EAAUQ,EAAMpC,KAAK6K,MAAgB,SAAG/I,EAAKC,EAAKC,GAElDJ,EAAUQ,EAAMpC,KAAK6K,MAAe,QAAE7K,KAAKqL,QAAU,GAAIvJ,EAAKC,EAAKC,KE9CrE0N,QFkDM,MACN7E,KAAO,UACPrJ,MAAO,EACPmO,WAAa,EACbC,QAAU,GACVC,WACM,GAAK7P,KAAK2P,YACd3P,KAAK2P,UAAY3P,KAAK4P,QACtB5P,KAAKwB,UAAOlC,GAGduF,OAAO0B,EAAOxE,EAAKC,GAClB,GAAI,GAAKhC,KAAK2P,UAIb,OAHApJ,EAAMuF,cAAc/J,EAAKC,GACzBuE,EAAMsC,OAAS,SACfvD,EAAU,WAEJ,GAAItF,KAAK2P,UAAY,EAC1B3P,KAAc,gBACT,CAGN,IAFA,IAAIsP,EAAY/I,EAAMgH,aAAaxL,EAAKC,GACpCwL,EAAM8B,EAAUnO,OACXG,EAAI,EAAGA,EAAIkM,EAAKlM,IAAK,CAC7B,IAAIuF,EAASN,EAAMO,UAAUwI,EAAUhO,GAAGS,IAAKuN,EAAUhO,GAAGU,KAC5D,GAAI1C,MAAauH,GAAUA,EAAOgE,MAAQ7K,KAAK6K,KAAM,EAC3B,GAArBhE,EAAO8I,WAAmB9I,EAAO8I,WAAa3P,KAAK4P,SACtD5P,KAAK6P,UAEN,OAGFP,EAAUjJ,OAAO,EAAGiJ,EAAUnO,SAGhC2D,OAAOhD,EAAKC,EAAKC,GACZhC,KAAK2P,UAAY,EACpB/N,EAAUQ,EAAMpC,KAAK6K,MAAM7K,KAAK2P,UAAY,GAAI7N,EAAKC,EAAKC,GAE1DJ,EAAUQ,EAAMpC,KAAK6K,MAAM,GAAI/I,EAAKC,EAAKC,KEvF3C8N,KF2FM,MACNjF,KAAO,OACPC,SAAU,EACVkD,OAAO7K,GAEN,IADA,IAAIqK,EAAMrK,EAAOoD,MAAMtG,KAAKkB,OACnBG,EAAI,EAAGA,EAAIkM,EAAKlM,IAAK,CAC7B,IAAIuF,EAAS1D,EAAOoD,MAAMtG,KAAKqB,GAC/B,GAAIhC,MAAauH,EAGjB,OAAQA,EAAOgE,MACd,IAAK,MACJhE,EAAOxB,MAAO,EACf,MACA,IAAK,OACJwB,EAAOxB,UAAO/F,IAKlBwF,OAAOhD,EAAKC,EAAKC,GAChBJ,EAAUQ,EAAMpC,KAAK6K,MAAO/I,EAAKC,EAAKC,KE/GvC+N,IFkHM,MACNlF,KAAO,MACPxF,MAAO,EACPqG,KAAM,EACNZ,SAAU,EACVkD,OAAO7K,GAEN,IADA,IAAIqK,EAAMrK,EAAOoD,MAAMtG,KAAKkB,OACnBG,EAAI,EAAGA,EAAIkM,EAAKlM,IAAK,CAC7B,IAAIuF,EAAS1D,EAAOoD,MAAMtG,KAAKqB,GAC3BhC,MAAauH,GAAU,UAAYA,EAAOgE,OAC7ChE,EAAOmJ,WAAanJ,EAAOmJ,WAG7B7M,EAAOoD,MAAMsC,OAAS,IAEvB/D,OAAOhD,EAAKC,EAAKC,GAChBJ,EAAUQ,EAAMpC,KAAK6K,MAAO/I,EAAKC,EAAKC,GAEvC+E,UAAUR,EAAOxE,EAAKC,GACrB,MAAO,CAAC,CAACD,IAAIA,EAAKC,IAAKA,MEpIxBiO,OFuIM,MACNpF,KAAO,SACPxF,MAAO,EACPqG,KAAM,EACNZ,SAAU,EACVlL,YAAYoQ,GACXhQ,KAAKgQ,UAAYA,EAElBhC,OAAO7K,GACFnD,KAAKgQ,UACR7M,EAAOH,UAAW,EAElBG,EAAOoD,MAAMsC,OAAS,GAGxB/D,OAAOhD,EAAKC,EAAKC,GACZhC,KAAKgQ,UACRpO,EAAUQ,EAAMpC,KAAK6K,MAAM,GAAI/I,EAAKC,EAAKC,GAEzCJ,EAAUQ,EAAMpC,KAAK6K,MAAM,GAAI/I,EAAKC,EAAKC,GAG3C+E,UAAUR,EAAOxE,EAAKC,GACrB,OAAIhC,KAAKgQ,UACD,CAAC,CAACjO,IAAIA,EAAKC,IAAKA,IAEjB,KEhKRkO,IFmKM,MACNrF,KAAO,MACPxF,MAAO,EACPyF,SAAU,EACVkD,OAAO7K,GAEN,IADA,IAAIqK,EAAMrK,EAAOoD,MAAMtG,KAAKkB,OACnBG,EAAI,EAAGA,EAAIkM,EAAKlM,IAAK,CAC7B,IAAIuF,EAAS1D,EAAOoD,MAAMtG,KAAKqB,GAC/B,GAAIhC,MAAauH,EAGjB,OAAQA,EAAOgE,MACd,IAAK,MACJhE,EAAOxB,UAAO/F,EACf,MACA,IAAK,OACJuH,EAAOxB,MAAO,IAKlBP,OAAOhD,EAAKC,EAAKC,GAChBJ,EAAUQ,EAAMpC,KAAK6K,MAAO/I,EAAKC,EAAKC,KExLvCmO,SF2LM,MACNtF,KAAO,WACPC,SAAU,EACVsF,YAAc,IAAIzQ,MAClB0Q,kBAAoB,IAAI1Q,MAExB2Q,SAAS/J,EAAOxE,EAAKC,GACpB,IAAIf,EAAS,IAAItB,MACjBK,KAAKqQ,kBAAkBhK,OAAO,EAAGrG,KAAKqQ,kBAAkBlP,QAGxD,IAAK,IAAIoP,EAAQvO,EAAM,EAAGuO,GAAS,EAAGA,IAAS,CAC9C,IAAI1J,EAASN,EAAMO,UAAU/E,EAAKwO,GAElC,GADAvQ,KAAKqQ,kBAAkB7O,KAAK,CAACO,IAAIA,EAAKC,IAAIuO,IACtCjR,MAAauH,EAAQ,CACxB5F,EAAOO,KAAK,CAACO,IAAIA,EAAKC,IAAIuO,EAAOvP,IAAIuC,YACrC,OAKF,IAAK,IAAIiN,EAAQzO,EAAM,EAAGyO,EAAQjK,EAAMI,KAAM6J,IAAS,CAClD3J,EAASN,EAAMO,UAAU0J,EAAOxO,GAEpC,GADAhC,KAAKqQ,kBAAkB7O,KAAK,CAACO,IAAIyO,EAAOxO,IAAIA,IACxC1C,MAAauH,EAAQ,CACxB5F,EAAOO,KAAK,CAACO,IAAIyO,EAAOxO,IAAIA,EAAKhB,IAAIwC,WACrC,OAKF,IAASgN,EAAQzO,EAAM,EAAGyO,GAAS,EAAGA,IAAS,CAC1C3J,EAASN,EAAMO,UAAU0J,EAAOxO,GAEpC,GADAhC,KAAKqQ,kBAAkB7O,KAAK,CAACO,IAAIyO,EAAOxO,IAAIA,IACxC1C,MAAauH,EAAQ,CACxB5F,EAAOO,KAAK,CAACO,IAAIyO,EAAOxO,IAAIA,EAAKhB,IAAIyC,WACrC,OAKF,IAAS8M,EAAQvO,EAAM,EAAGuO,EAAQhK,EAAMK,KAAM2J,IAAS,CAClD1J,EAASN,EAAMO,UAAU/E,EAAKwO,GAElC,GADAvQ,KAAKqQ,kBAAkB7O,KAAK,CAACO,IAAIA,EAAKC,IAAIuO,IACtCjR,MAAauH,EAAQ,CACxB5F,EAAOO,KAAK,CAACO,IAAIA,EAAKC,IAAIuO,EAAOvP,IAAI0C,YACrC,OAIF,OAAQzC,EAAOE,OAAS,EAAIF,OAAS3B,EAEtCmR,WAAWlK,EAAOxE,EAAKC,EAAK0O,GAC3B,OAAQA,EAAY1P,KACnB,KAAKuC,UACJ,IAAK,IAAInD,EAAI4B,EAAM,EAAG5B,EAAIsQ,EAAY1O,IAAK5B,IAC1CmG,EAAM2E,UAAUnJ,EAAK3B,EAAG,IAAIgL,EAAY7H,YAE1C,MACA,KAAKC,SACJ,IAAK,IAAIrD,EAAI4B,EAAM,EAAG5B,EAAIuQ,EAAY3O,IAAK5B,IAC1CoG,EAAM2E,UAAU/K,EAAG6B,EAAK,IAAIoJ,EAAY5H,WAE1C,MACA,KAAKC,SACJ,IAAStD,EAAI4B,EAAM,EAAG5B,EAAIuQ,EAAY3O,IAAK5B,IAC1CoG,EAAM2E,UAAU/K,EAAG6B,EAAK,IAAIoJ,EAAY3H,WAE1C,MACA,KAAKC,UACJ,IAAStD,EAAI4B,EAAM,EAAG5B,EAAIsQ,EAAY1O,IAAK5B,IAC1CmG,EAAM2E,UAAUnJ,EAAK3B,EAAG,IAAIgL,EAAY1H,YAI3C4B,EAAU,aAEXT,OAAO0B,EAAOxE,EAAKC,GAElB,GADAhC,KAAKoQ,YAAcpQ,KAAKsQ,SAAS/J,EAAOxE,EAAKC,GACzC1C,MAAaU,KAAKoQ,YACrB,IAAK,IAAI9O,EAAI,EAAGA,EAAItB,KAAKoQ,YAAYjP,OAAQG,IAAK,CACjD,IAAIqN,EAAM3O,KAAKoQ,YAAY9O,GACvBuF,EAASN,EAAMO,UAAU6H,EAAI5M,IAAK4M,EAAI3M,KACtC1C,MAAauH,GAAU,gBAAkBA,EAAOgE,MAChDhE,EAAOtE,IAAIqL,WAAa,IACvB/G,EAAOkE,UAAYlE,EAAOtE,IAAI+B,SAASK,aAC3C4B,EAAM2E,UAAUyD,EAAI5M,IAAK4M,EAAI3M,IAC5B,IAAI6J,EAAqBhF,EAAOtE,MACjCgE,EAAMqF,cAAc/E,EAAOtE,KAC3BvC,KAAKyQ,WAAWlK,EAAOxE,EAAKC,EAAK2M,IAIpC3O,KAAKoQ,YAAY/J,OAAO,EAAGrG,KAAKoQ,YAAYjP,QAE7C2D,OAAOhD,EAAKC,EAAKC,GAChBJ,EAAUQ,EAAMpC,KAAK6K,MAAO/I,EAAKC,EAAKC,GAEvC+E,UAAUR,EAAOxE,EAAKC,GACrB,OAAOhC,KAAKqQ,oBE7RbM,SFgSM,MACN9F,KAAO,WACPxF,MAAO,EACPqG,KAAM,EACNZ,SAAU,EACVlL,YAAYoQ,GACXhQ,KAAKgQ,UAAYA,EAElBhC,OAAO7K,GACFnD,KAAKgQ,UACR7M,EAAOH,UAAW,GAElBG,EAAOoD,MAAMsC,OAAS,IACtB1F,EAAO+G,UAAW,GAGpBpF,OAAOhD,EAAKC,EAAKC,GACZhC,KAAKgQ,UACRpO,EAAUQ,EAAMpC,KAAK6K,MAAM,GAAI/I,EAAKC,EAAKC,GAEzCJ,EAAUQ,EAAMpC,KAAK6K,MAAM,GAAI/I,EAAKC,EAAKC,GAG3C+E,UAAUR,EAAOxE,EAAKC,GACrB,OAAIhC,KAAKgQ,UACD,CAAC,CAACjO,IAAIA,EAAKC,IAAIA,IAEhB,KE1TR4O,QF6TM,MACN/F,KAAO,UACPa,KAAM,EACNZ,SAAU,EACV5H,KAAO,EACPD,OAAS,EACTG,KAAO,CACNyH,UAAMvL,EACN0B,SAAK1B,EACL+L,QAAS,EACTwF,eAAWvR,EACXwR,eAAWxR,GAEZM,YAAYmR,GAQX/Q,KAAKgR,OAAUD,EAAS,IAAM,IAE/BE,SACK,KAAOjR,KAAKgR,SACfhR,KAAKkD,KAAOd,EAAMpC,KAAK6K,MAAY,KAAE1J,OACrCnB,KAAKgR,OAAS,KAGhBE,SAAS3K,EAAOxE,EAAKC,GAGpB,OAFAhC,KAAKgR,OAAS,IACdzK,EAAM2E,UAAUlL,KAAKoD,KAAKyN,UAAW7Q,KAAKoD,KAAK0N,eAAWxR,GAClDU,KAAKoD,KAAKyH,MACjB,IAAK,SACJ7K,KAAKiD,QAAU,EAChB,MACA,IAAK,QACJjD,KAAKiD,OAAS,IACf,MACA,IAAK,cACJjD,KAAKiD,OAAS,MAIjBqN,SAAS/J,EAAOxE,EAAKC,EAAK6I,GAKzB,IAJA,IAAI5J,OAAS3B,EAETgQ,EAAY/I,EAAMgH,aAAaxL,EAAKC,GACpCwL,EAAM8B,EAAUnO,OACXG,EAAI,EAAGA,EAAIkM,EAAKlM,IAAK,CAC7B,IAAIuF,EAASN,EAAMO,UAAUwI,EAAUhO,GAAGS,IAAKuN,EAAUhO,GAAGU,KAC5D,GAAI1C,MAAauH,GAAUA,EAAOgE,MAAQA,EAAK,CAC9C,GAAY,gBAARA,EAAwB,CACdhE,EAAOtE,IACTqL,WAAa,IACvB3M,EAAS,CACR4J,KAAMhE,EAAOgE,KACbhE,OAAQA,EACR9E,IAAKuN,EAAUhO,GAAGS,IAClBC,IAAKsN,EAAUhO,GAAGU,IAClBhB,IAAKsO,EAAUhO,GAAGN,WAIpBC,EAAS,CACR4J,KAAMhE,EAAOgE,KACbhE,OAAQA,EACR9E,IAAKuN,EAAUhO,GAAGS,IAClBC,IAAKsN,EAAUhO,GAAGU,IAClBhB,IAAKsO,EAAUhO,GAAGN,KAGpB,OAIF,OADAsO,EAAUjJ,OAAO,EAAGiJ,EAAUnO,QACvBF,EAERkQ,OAAO5K,EAAOxE,EAAKC,EAAKoP,GACvBpR,KAAKgR,OAAS,IACdzK,EAAM2E,UAAUkG,EAASrP,IAAKqP,EAASpP,IAAK,IAAIuJ,EAAc6F,EAASpQ,IAAKoQ,EAASvG,OACrF7K,KAAKoD,KAAKyH,KAAOuG,EAASvG,KAC1B7K,KAAKoD,KAAKpC,IAAMoQ,EAASpQ,IACzBhB,KAAKoD,KAAKyN,UAAYO,EAASrP,IAC/B/B,KAAKoD,KAAK0N,UAAYM,EAASpP,IAC/BhC,KAAKoD,KAAKiI,QAAU,EACpB/F,EAAU,QAEXT,OAAO0B,EAAOxE,EAAKC,GAClB,OAAQhC,KAAKgR,QACZ,IAAK,IAEA1R,OADA8R,EAAWpR,KAAKsQ,SAAS/J,EAAOxE,EAAKC,EAAK,kBAChBoP,EAASvK,OAAOtE,IAAI+B,SAASK,YAC1D3E,KAAKiR,SAEP,MACA,IAAK,IACJjR,KAAKkD,OACDlD,KAAKkD,MAAQ,IAChBlD,KAAKgR,OAAS,KAEhB,MACA,IAAK,IACJ,IAAII,OAAW9R,EACf,EAAG,CAEF,GAAIA,OADJ8R,EAAWpR,KAAKsQ,SAAS/J,EAAOxE,EAAKC,EAAK,mBAErCoP,EAASvK,OAAOkE,UAChBqG,EAASvK,OAAOtE,IAAI+B,SAASK,WAAY,CAC7C4B,EAAMqF,cAAcwF,EAASvK,OAAOtE,KACpC,MAGD,GAAIjD,OADJ8R,EAAWpR,KAAKsQ,SAAS/J,EAAOxE,EAAKC,EAAK,UAEzC,MAGD,GAAI1C,OADJ8R,EAAWpR,KAAKsQ,SAAS/J,EAAOxE,EAAKC,EAAK,gBAEzC,MAIDoP,OAAW9R,QACL,GACHA,MAAa8R,GAChBpR,KAAKmR,OAAO5K,EAAOxE,EAAKC,EAAKoP,GAE/B,MACA,IAAK,IACJpR,KAAKoD,KAAKiI,UACN,GAAKrL,KAAKoD,KAAKiI,SAClBrL,KAAKkR,SAAS3K,EAAOxE,EAAKC,GAE5B,MACA,IAAK,IACAhC,KAAKiD,OAAS,IACjBjD,KAAKiD,SACD,GAAKjD,KAAKiD,SACbjD,KAAKgR,OAAS,OAMnBlM,OAAOhD,EAAKC,EAAKC,GACb,IAACC,EAAKoP,EAAwBC,EACjC,OAAQtR,KAAKgR,QACZ,IAAK,IACJ/O,EAAMG,EAAMpC,KAAK6K,MAAc,OAAE,GAClC,MACA,IAAK,IACJwG,EAAajP,EAAMpC,KAAK6K,MAAY,KAAE1J,OAEtCmQ,GADAA,EAAStR,KAAKkD,MAAQ,EAAIlD,KAAKkD,KAAO,GACrBmO,EAAaC,EAAQD,EAAa,EACnDpP,EAAMG,EAAMpC,KAAK6K,MAAY,KAAEyG,GAChC,MACA,IAAK,IACJrP,EAAMG,EAAMpC,KAAK6K,MAAY,KAAE,GAChC,MACA,IAAK,IACJ5I,EAAMG,EAAMpC,KAAK6K,MAAY,KAAE7K,KAAKoD,KAAKpC,KAC1C,MACA,IAAK,IAEJ,OADAqQ,EAAajP,EAAMpC,KAAK6K,MAAc,OAAE1J,OAChCnB,KAAKoD,KAAKyH,MACjB,IAAK,QAEJyG,GADAA,EAAQpP,KAAKqP,KAAKvR,KAAKiD,OAAS,KACfoO,EAAaC,EAAQD,EAAa,EACnDpP,EAAMG,EAAMpC,KAAK6K,MAAc,OAAEyG,GAClC,MACA,IAAK,cAEJA,GADAA,EAAQpP,KAAKqP,KAAKvR,KAAKiD,OAAS,MACfoO,EAAaC,EAAQD,EAAa,EACnDpP,EAAMG,EAAMpC,KAAK6K,MAAc,OAAEyG,GAClC,MACA,QACCA,EAAQpP,KAAKC,MAAsB,EAAhBD,KAAKsP,UACxBvP,EAAMG,EAAMpC,KAAK6K,MAAc,OAAEyG,IAOrC1P,EAAUK,EAAKH,EAAKC,EAAKC,GAE1B+E,UAAUR,EAAOxE,EAAKC,GAGrB,IAFA,IAAIf,EAAS,IAAItB,MACb2P,EAAY/I,EAAMgH,aAAaxL,EAAKC,OAAK1C,GACpCgC,EAAI,EAAGA,EAAIgO,EAAUnO,OAAQG,IACrCL,EAAOO,KAAK,CAACO,IAAIuN,EAAUhO,GAAGS,IAAKC,IAAIsN,EAAUhO,GAAGU,MAIrD,OAFAf,EAAOO,KAAK,CAACO,IAAIA,EAAKC,IAAKA,IAC3BsN,EAAUjJ,OAAO,EAAGiJ,EAAUnO,QACvBF,IE9fRwQ,KFigBM,MACN5G,KAAO,OACPxF,MAAO,EACPqG,KAAM,EACNZ,SAAU,EACVkD,OAAO7K,GACNA,EAAOyK,WAAa,IAErB9I,OAAOhD,EAAKC,EAAKC,GAChBJ,EAAUQ,EAAMpC,KAAK6K,MAAO/I,EAAKC,EAAKC,KEzgBvC0P,SFkqBM,MACN7G,KAAO,WACPxF,MAAO,EACPyF,SAAU,EACVkD,OAAO7K,GACNA,EAAOoD,MAAMsC,OAAS,IAEvB/D,OAAOhD,EAAKC,EAAKC,GAChBJ,EAAUQ,EAAMpC,KAAK6K,MAAO/I,EAAKC,EAAKC,KEzqBvC2P,KF4qBM,MACN9G,KAAO,OACPjL,YAAYiK,GACX7J,KAAK6J,MAAMA,EAEZ/E,OAAOhD,EAAKC,EAAKC,GAChBJ,EAAUQ,EAAMpC,KAAK6K,MAAM7K,KAAK6J,OAAQ/H,EAAKC,EAAKC,KEjrBnDN,QAAAA,EACAC,QAAAA,YACA4B,WACAC,WACAC,YACAC,WJ5DqB,cACC,aACD,II8DrBuI,UAAAA,EACA2F,WD3DM,SAAoB3G,GAC1B,IAAIjK,EAAMiK,EAAM3G,SAAStD,IACzB,MAAO,CACNA,EACA2C,EAAU3C,EAAKmL,WACfxI,EAAU3C,EAAKkL,UACfvI,EAAU3C,EAAKoL,YCsDhByF,gBDnDM,SAAyB5G,GAC/B,IAAIjK,EAAMiK,EAAM3G,SAAStD,IACzB,OAAIkB,KAAKsP,UAAY,GACb,CACNxQ,EACA2C,EAAU3C,EAAKkL,UACfvI,EAAU3C,EAAKmL,WACfxI,EAAU3C,EAAKoL,WAGT,CACNpL,EACA2C,EAAU3C,EAAKmL,WACfxI,EAAU3C,EAAKkL,UACfvI,EAAU3C,EAAKoL,YCsCjB0F,WDlCM,SAAoB7G,GAE1B,IADA,IAAIhK,EAAS,CAACsC,UAAWC,SAAUC,SAAUC,WACpCpC,EAAI,EAAGA,EAAIL,EAAOE,OAAQG,IAAK,CACvC,IAAIyQ,EAAQ7P,KAAKC,MAAMD,KAAKsP,UAAYlQ,EAAI,IACxC0Q,EAAO/Q,EAAO8Q,GAClB9Q,EAAO8Q,GAAS9Q,EAAOK,GACvBL,EAAOK,GAAK0Q,EAEb,OAAO/Q,KC+CO,SAASqL,EAAU2F,GACjC,IAAInQ,EAAM0D,SAASC,cAAc,gBAAgByM,WAAW,MACxD3F,EAAa,EACb4F,EAAW,EAGf3M,SAASC,cAAc,qBAAqBC,SAAU,EACtDF,SAASC,cAAc,qBAAqByD,iBAAiB,UAAUkB,IACtE,IAAIgI,EAAY3F,aAAaC,QAAQ,eACrC0F,EAAcA,EAAczF,KAAKC,MAAMwF,GAAe,GACtDA,EAAYC,QAAQjI,EAAEkI,OAAO5M,QAC7B+G,aAAaI,QAAQ,cAAcF,KAAKG,UAAUsF,IAClDhI,EAAEkI,OAAOC,UAIV,IACC,IAAIH,EAAY3F,aAAaC,QAAQ,eAClC0F,IACFA,EAAYzF,KAAKC,MAAMwF,GACvB5M,SAASC,cAAc,qBAAqBC,QAAU0M,EAAYC,SAEnE,MAAMjI,GACNvC,QAAQC,MAAMsC,GAIf,IACC,IAAIoC,EAAYC,aAAaC,QAAQ,iBAClCF,IACFA,EAAYG,KAAKC,MAAMJ,GACvBD,EAAWC,EAAYF,EAAW,gBAAahN,EAC/C6S,EAAS3F,EAAYF,EAAW,gBAAahN,GAE9C,MAAM8K,GACNvC,QAAQC,MAAMsC,GAYf,GAVI9K,MAAaiN,GAAeiG,MAAMjG,KACrCA,EAAakG,OAAOlG,KAKpB4F,EAHG7S,MAAa6S,GAAaK,MAAML,GAGxB5F,EAAa,EAFbkG,OAAON,KAMHF,EAAU9Q,OAEzB,YADAkL,EAAmBC,EAAUC,GAK9B,IAAImG,EAAQ,IAAI9J,EAAMqJ,EAAUE,GAAWrQ,GAC3C0D,SAASC,cAAc,cAAcwE,UAAWkI,EAAW,EAC3D,MAAM3I,EAAS,SAASmJ,GACvBpG,GAAcoG,EACdR,IACA,IACC,IAAI3F,EAAYC,aAAaC,QAAQ,iBAEpCF,EADEA,EACUG,KAAKC,MAAMJ,GAEX,GAEbA,EAAYF,EAAW,UAAU6F,EACjC3F,EAAYF,EAAW,UAAUC,EACjCE,aAAaI,QAAQ,gBAAgBF,KAAKG,UAAUN,IACpD,MAAMpC,GACNvC,QAAQC,MAAMsC,GAEX+H,EAAWF,EAAU9Q,SAExBuR,EAAQ,IAAI9J,EAAMqJ,EAAUE,GAAWrQ,IACjC0H,SAASA,GACfhE,SAASC,cAAc,cAAcwE,UAAWkI,EAAW,IAG3DO,OAAQpT,EACR+M,EAAmBC,EAAUC,KAG/BmG,EAAMlJ,SAASA"}